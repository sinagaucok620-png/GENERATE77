<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GO-BAK2 GENERATE - Advanced Logic V22 (Smart Pattern)</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #00f2ff;
            --glass-bg: rgba(15, 20, 30, 0.90);
            --glass-border: rgba(255, 255, 255, 0.15);
            --win-green: #00ff88;
            --warn-yellow: #ffd700;
            --danger-red: #ff3e3e;
        }

        * { box-sizing: border-box; } 

        body { 
            font-family: 'Rajdhani', sans-serif; 
            margin: 0; padding: 40px 20px;
            color: #fff; -webkit-font-smoothing: antialiased;
            min-height: 100vh; background-color: #000;
            overflow-x: hidden; cursor: crosshair;
            transition: background 0.3s ease;
        }

        #nebula-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; }
        #cursor-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; pointer-events: none; }
        #particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9998; pointer-events: none; }

        .container { 
            max-width: 1300px; margin: auto; 
            background: var(--glass-bg);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            padding: 40px; border-radius: 20px; 
            border: 1px solid var(--glass-border);
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 50px rgba(0,0,0,0.8); 
            position: relative; z-index: 1;
            transition: all 0.3s ease;
        }

        .header-area { 
            text-align: center; margin-bottom: 30px; 
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 20px;
        }
        .header-area h2 { 
            color: var(--primary); margin: 0 0 20px 0; font-size: 48px; font-weight: 800; 
            letter-spacing: 5px; text-transform: uppercase;
            text-shadow: 0 0 20px var(--primary);
        }
        
        .date-range-wrapper {
            display: inline-flex; align-items: flex-end; gap: 15px;
            background: rgba(0,0,0,0.3); padding: 15px 25px; border-radius: 12px;
            border: 1px solid var(--glass-border); margin-bottom: 10px;
        }
        .date-input-group { display: flex; flex-direction: column; gap: 5px; text-align: left; }
        .date-input-group label { font-size: 11px; color: var(--primary); font-weight: bold; letter-spacing: 1px; }
        .arrow-separator { font-size: 24px; color: #fff; padding-bottom: 8px; opacity: 0.5; }

        #displayDate { 
            color: #aaa; font-size: 12px; margin-top: 10px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase;
        }

        .controls { 
            display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap; 
            background: rgba(0,0,0,0.4); padding: 20px; border-radius: 15px; margin-bottom: 20px;
            border: 1px solid var(--glass-border);
        }

        .time-settings {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;
            margin-bottom: 30px; border: 1px dashed rgba(255,255,255,0.2);
            width: 100%; max-width: 1220px; margin: 0 auto 30px;
        }
        .time-settings summary { cursor: pointer; color: var(--warn-yellow); font-weight: bold; margin-bottom: 10px; outline: none; }
        .time-inputs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        .time-group label { display: block; font-size: 10px; color: #aaa; margin-bottom: 3px; }
        .time-group input { width: 90%; font-size: 12px; padding: 8px; }

        input, select { 
            background: rgba(255,255,255,0.05); color: #fff; border: 1px solid rgba(255,255,255,0.1); 
            padding: 12px 20px; border-radius: 8px; font-size: 14px; outline: none; 
            font-family: 'Rajdhani', sans-serif; font-weight: 700; cursor: pointer;
        }
        input:focus, select:focus { border-color: var(--primary); background: #000; }
        input[type="date"] { text-transform: uppercase; color-scheme: dark; }
        input[readonly] { background: rgba(0,0,0,0.3); color: #aaa; border-color: transparent; cursor: default; }

        button { 
            background: var(--primary); color: #000; border: none; 
            padding: 12px 25px; cursor: pointer; border-radius: 8px; font-weight: 800; 
            text-transform: uppercase; font-size: 14px; transition: 0.3s;
            position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 0 20px var(--primary); }
        button:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(100%); }
        
        #lockBtn { padding: 12px 15px; width: 50px; background: rgba(255,255,255,0.1); color: #fff; }
        #lockBtn.locked { background: var(--danger-red); }

        #shareBtn { background: #6c5ce7; color: #fff; }
        #shareBtn:hover { box-shadow: 0 0 15px #6c5ce7; }
        
        #copyAllBtn { background: #e056fd; color: #fff; }
        #copyAllBtn:hover { box-shadow: 0 0 15px #e056fd; }
        
        #designerBtn { background: #fff; color: #000; border: 1px solid #999; }
        #designerBtn:hover { box-shadow: 0 0 15px #fff; }
        
        #dbBtn { background: #ff9f43; color: #000; }
        #dbBtn:hover { box-shadow: 0 0 15px #ff9f43; }

        /* DAY & SESSION STYLES */
        .day-row { margin-bottom: 50px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; transition: all 0.3s; }
        .day-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; border-left: 5px solid var(--primary); padding-left: 15px; }
        .day-label { font-size: 28px; color: #fff; font-weight: 800; display: flex; align-items: center; gap: 15px; text-shadow: 0 0 10px rgba(255,255,255,0.2); }
        .minimize-day-btn { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); width: 35px; height: 35px; border-radius: 8px; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: 0.3s; }
        .minimize-day-btn:hover { background: var(--primary); color: #000; }
        .day-row.collapsed .session-grid { display: none; }
        .day-row.collapsed { margin-bottom: 10px; border: none; padding-top: 10px; opacity: 0.6; }
        .date-badge { font-size: 16px; background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 6px; color: var(--primary); letter-spacing: 1px; font-family: monospace; }
        
        .session-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .session-box { 
            background: rgba(255,255,255,0.03); padding: 20px; border-radius: 15px; 
            border: 1px solid rgba(255,255,255,0.05); height: 100%; 
            transition: 0.3s; position: relative; display: flex; flex-direction: column; overflow: hidden;
        }
        .session-box:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .session-box.active-now { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); animation: pulseBorder 2s infinite; }
        @keyframes pulseBorder { 0% { box-shadow: 0 0 5px rgba(0, 242, 255, 0.2); } 50% { box-shadow: 0 0 20px rgba(0, 242, 255, 0.5); } 100% { box-shadow: 0 0 5px rgba(0, 242, 255, 0.2); } }

        .session-header { display: flex; flex-direction: column; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 10px; position: relative; }
        .action-container { position: absolute; top: 0; right: 0; display: flex; gap: 5px; }
        .action-btn { background: rgba(0,0,0,0.5); color: #aaa; border: 1px solid rgba(255,255,255,0.2); width: 28px; height: 28px; padding: 0; border-radius: 6px; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: 0.2s; font-size: 11px; }
        .action-btn:hover { background: var(--primary); color: #000; border-color: var(--primary); }
        .session-content { transition: all 0.3s ease; opacity: 1; max-height: 2000px; }
        .session-box.collapsed .session-content { opacity: 0; max-height: 0; margin: 0; padding: 0; overflow: hidden; }
        .session-box.collapsed { height: auto; min-height: 80px; }
        .session-title { color: var(--primary); font-weight: 800; font-size: 16px; margin-bottom: 5px; text-transform: uppercase; }
        .session-time { font-size: 11px; color: #aaa; display: block; margin-bottom: 5px; font-family: monospace; }
        .provider-label { font-size: 10px; color: #888; font-weight: 700; margin: 15px 0 5px; text-transform: uppercase; letter-spacing: 1px; }

        .game-card { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid transparent; transition: 0.2s; cursor: pointer; border-top: 1px solid rgba(255,255,255,0.05); }
        .game-card:hover { border-color: var(--primary); background: var(--primary); box-shadow: 0 0 15px var(--primary); }
        .game-card:hover .game-name { color: #000; text-shadow: none; }
        .game-name { font-size: 12px; font-weight: 700; color: #ddd; }
        .badge { font-size: 9px; padding: 2px 6px; border-radius: 4px; background: #000; border: 1px solid #333; }

        .depo-container { margin-top: auto; background: rgba(0,0,0,0.2); border: 1px dashed rgba(255,255,255,0.2); border-radius: 10px; padding: 15px; }
        .depo-header { font-size: 11px; color: var(--primary); font-weight: 800; text-align: center; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; }
        .depo-item { margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }
        .depo-item:last-child { border: none; margin: 0; }
        .depo-info { font-size: 11px; color: #fff; display: block; margin-bottom: 3px; }
        .depo-meta { font-size: 10px; display: flex; justify-content: space-between; }
        .tag-bonus { color: #ff9f43; font-weight: 800; } .tag-rate { color: var(--win-green); font-weight: 800; }

        .guide-container { margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.02); border-radius: 8px; }

        /* --- STYLING BARU UNTUK POLA & TOMBOL HAPUS --- */
        .step-row {
            font-size: 10px;
            color: #888;
            margin-bottom: 4px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding: 4px 0;
            display: flex; 
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        .step-text { flex: 1; text-align: left; }
        .delete-item-btn {
            background: rgba(255, 62, 62, 0.1);
            color: var(--danger-red);
            border: 1px solid var(--danger-red);
            width: 24px;
            height: 24px;
            border-radius: 6px;
            font-size: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0.7;
            flex-shrink: 0;
        }
        .delete-item-btn:hover {
            background: var(--danger-red);
            color: #fff;
            opacity: 1;
            box-shadow: 0 0 10px rgba(255, 62, 62, 0.4);
        }

        .toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 10000; pointer-events: none; }
        .toast { background: rgba(10, 10, 10, 0.95); border: 2px solid var(--primary); color: var(--primary); padding: 15px 40px; border-radius: 50px; font-weight: 800; font-size: 14px; letter-spacing: 2px; text-transform: uppercase; box-shadow: 0 0 50px var(--primary); opacity: 0; transform: translateY(20px); transition: all 0.4s; display: flex; align-items: center; gap: 12px; }
        .toast.show { opacity: 1; transform: translateY(0); }

        #hover-tooltip { position: fixed; display: none; z-index: 10000; background: #000; border: 2px solid var(--primary); border-radius: 10px; padding: 5px; box-shadow: 0 0 20px rgba(0,0,0,0.8); pointer-events: none; max-width: 200px; }
        #hover-tooltip img { width: 100%; border-radius: 5px; }

        /* --- MODAL STYLE --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: #111; padding: 25px; border: 1px solid var(--primary); border-radius: 15px; max-width: 600px; width: 90%; text-align: center; box-shadow: 0 0 30px var(--primary); position: relative; }
        .modal-content img { width: 100%; border-radius: 10px; margin-bottom: 10px; }
        .close-modal { position: absolute; top: 15px; right: 15px; color: #fff; background: none; border: 1px solid rgba(255,255,255,0.2); width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .close-modal:hover { background: var(--danger-red); border-color: var(--danger-red); }
        .modal-title { font-size: 18px; color: #fff; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 10px; }
        
        /* DATABASE TABLE STYLE FIXED */
        .db-controls { display: flex; gap: 10px; margin-bottom: 15px; }
        .db-search { flex: 1; background: #222; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 6px; }
        .db-table-container { max-height: 300px; overflow-y: auto; text-align: left; }
        .db-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .db-table th { position: sticky; top: 0; background: #000; color: var(--primary); padding: 10px; border-bottom: 2px solid var(--primary); text-transform: uppercase; text-align: left; }
        .db-table td { padding: 8px 10px; border-bottom: 1px solid #333; color: #ccc; vertical-align: middle; }
        .db-table tr:hover { background: rgba(255,255,255,0.05); }
        
        .db-action-group { display: flex; gap: 8px; align-items: center; justify-content: flex-start; }
        .btn-db-action { border: none; padding: 0 12px; height: 32px; border-radius: 6px; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 12px; cursor: pointer; transition: all 0.2s ease; text-transform: uppercase; display: inline-flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-db-load { background: rgba(0, 255, 136, 0.1); border: 1px solid var(--win-green); color: var(--win-green); }
        .btn-db-load:hover { background: var(--win-green); color: #000; box-shadow: 0 0 15px rgba(0, 255, 136, 0.4); }
        .btn-db-del { background: rgba(255, 62, 62, 0.1); border: 1px solid var(--danger-red); color: var(--danger-red); min-width: 32px; padding: 0; }
        .btn-db-del:hover { background: var(--danger-red); color: #fff; box-shadow: 0 0 15px rgba(255, 62, 62, 0.4); }
        .btn-csv { background: #10b981; color: #fff; border: none; padding: 12px; width: 100%; border-radius: 6px; margin-top: 15px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-csv:hover { box-shadow: 0 0 15px #10b981; }

        .preview-date { font-size: 14px; color: var(--warn-yellow); font-weight: 800; margin-bottom: 15px; }
        .preview-textarea { width: 100%; height: 300px; background: #000; color: var(--primary); border: 1px solid #333; border-radius: 8px; padding: 15px; font-family: 'Courier New', monospace; font-size: 11px; resize: none; margin-bottom: 15px; }
        .preview-textarea:focus { outline: none; border-color: var(--primary); }
        .btn-action-copy { background: var(--primary); color: #000; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 14px; }

        /* SCANNING */
        #scanOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 20000; justify-content: center; align-items: center; backdrop-filter: blur(10px); }
        .scan-content { text-align: center; width: 300px; font-family: 'Courier New', monospace; }
        .scan-icon { font-size: 50px; color: var(--primary); margin-bottom: 20px; text-shadow: 0 0 20px var(--primary); }
        .scan-text { color: #fff; font-size: 18px; font-weight: bold; margin-bottom: 10px; letter-spacing: 2px; }
        .scan-detail { color: var(--primary); font-size: 12px; margin-top: 5px; opacity: 0.8; }
        .scan-bar-container { width: 100%; height: 4px; background: #333; border-radius: 2px; overflow: hidden; position: relative; }
        .scan-bar { width: 0%; height: 100%; background: var(--primary); box-shadow: 0 0 10px var(--primary); transition: width 0.1s linear; }

        @media (max-width: 1100px) { .session-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 700px) { .container{padding:15px;} .session-grid { grid-template-columns: 1fr; } .time-inputs{ grid-template-columns: 1fr; } .date-range-wrapper{flex-wrap: wrap; justify-content: center;} .header-area h2 { font-size: 32px; } }

        body.clean-mode { background: #f4f6f8 !important; color: #222 !important; cursor: default; }
        body.clean-mode #nebula-canvas, body.clean-mode #cursor-canvas, body.clean-mode #particle-canvas { display: none !important; }
        body.clean-mode .container { background: #ffffff; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border: 1px solid #d1d5db; border-top: 5px solid #333; }
        body.clean-mode .header-area h2 { color: #111 !important; text-shadow: none !important; font-weight: 900; }
        body.clean-mode #displayDate { color: #555; font-weight: 600; }
        body.clean-mode .controls, body.clean-mode .time-settings { background: #f3f4f6; border: 1px solid #e5e7eb; box-shadow: none; color: #000; }
        body.clean-mode .time-settings summary { color: #333; }
        body.clean-mode .time-group label { color: #555; }
        body.clean-mode .time-group input { background: #fff; color: #000; border: 1px solid #ccc; }
        body.clean-mode #lockBtn, body.clean-mode #startDateInput, body.clean-mode #genBtn, body.clean-mode #historySelect, body.clean-mode #dbBtn, body.clean-mode #copyAllBtn { opacity: 0.3; pointer-events: none; filter: grayscale(100%); }
        body.clean-mode .day-label { color: #000; border-left-color: #000; text-shadow: none; }
        body.clean-mode .minimize-day-btn { background: #ccc; color: #000; border-color: #999; }
        body.clean-mode .date-badge { background: #e0e0e0; color: #333; font-weight: bold; border: 1px solid #ccc; }
        body.clean-mode .session-box { background: #fff; border: 2px solid #e5e7eb; box-shadow: none; }
        body.clean-mode .session-title { color: #000; border-bottom: 2px solid #000; }
        body.clean-mode .session-time { color: #666; font-weight: bold; }
        body.clean-mode .action-btn { background: #eee; color: #000; border-color: #ccc; }
        body.clean-mode .provider-label { color: #666; background: #eee; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        body.clean-mode .game-card { background: #f9fafb; border: 1px solid #d1d5db; color: #111; }
        body.clean-mode .game-card .game-name { color: #000; font-size: 13px; }
        body.clean-mode .game-card:hover { background: #fff; border-color: #000; box-shadow: none; }
        body.clean-mode .depo-container { background: #fffbe6; border: 1px solid #ffe58f; color: #000; }
        body.clean-mode .depo-header { color: #d46b08; border-bottom: 1px solid #ffe58f; }
        body.clean-mode .depo-info { color: #222; font-family: monospace; font-size: 12px; font-weight: bold; }
        body.clean-mode .badge { background: #eee !important; color: #000 !important; border: 1px solid #ccc; }
        body.clean-mode #designerBtn { background: #000; color: #fff; border-color: #000; }
        body.clean-mode .preview-textarea { background: #fff; color: #000; border-color: #ccc; }
        body.clean-mode .db-table th { background: #eee; color: #000; border-bottom: 2px solid #ccc; }
        body.clean-mode .db-table td { color: #000; border-bottom: 1px solid #ccc; }
        body.clean-mode .btn-db-load { background: #fff; border: 1px solid #ccc; color: #333; }
        body.clean-mode .btn-db-del { background: #fff; border: 1px solid #ffcccc; color: red; }
    </style>
</head>
<body>

<div id="scanOverlay">
    <div class="scan-content">
        <div class="scan-icon"><i class="fas fa-microchip fa-spin"></i></div>
        <div class="scan-text" id="scanText">INITIALIZING SYSTEM...</div>
        <div class="scan-bar-container">
            <div class="scan-bar" id="scanBar"></div>
        </div>
        <div class="scan-detail" id="scanDetail">Connect to server...</div>
    </div>
</div>

<canvas id="nebula-canvas"></canvas>
<canvas id="cursor-canvas"></canvas>
<canvas id="particle-canvas"></canvas>

<div class="toast-container"><div id="customToast" class="toast"><i class="fas fa-check-circle"></i> <span id="toastMsg">ACTION SUCCESSFUL</span></div></div>
<div id="hover-tooltip"><img id="tooltip-img" src="" alt=""></div>

<div id="gameModal" class="modal" onclick="document.getElementById('gameModal').style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <button class="close-modal" onclick="document.getElementById('gameModal').style.display='none'">X</button>
        <img id="modalImg" src="" alt="">
        <h3 id="modalName" style="color:var(--primary); margin:0;"></h3>
    </div>
</div>

<div id="dbModal" class="modal" onclick="document.getElementById('dbModal').style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()" style="width: 800px; max-width: 95%;">
        <button class="close-modal" onclick="document.getElementById('dbModal').style.display='none'"><i class="fas fa-times"></i></button>
        <div class="modal-title"><i class="fas fa-database"></i> RIWAYAT SEED (CART)</div>
        
        <div class="db-controls">
            <input type="text" id="dbSearch" class="db-search" placeholder="Cari Web / Tanggal..." onkeyup="renderDatabase()">
            <select id="dbFilter" class="db-search" onchange="renderDatabase()">
                <option value="">SEMUA WEB</option>
                <option value="CAPTAIN77">CAPTAIN77</option>
                <option value="PLAY77">PLAY77</option>
                <option value="JAGUAR77">JAGUAR77</option>
                <option value="FUN77">FUN77</option>
                <option value="INDOPEDIA77">INDOPEDIA77</option>
                <option value="INDOFUN17">INDOFUN17</option>
                <option value="HOLYPLAY17">HOLYPLAY17</option>
                <option value="MUSTANG77">MUSTANG77</option>
            </select>
        </div>

        <div class="db-table-container">
            <table class="db-table" id="dbTableBody">
                </table>
        </div>
        
        <button class="btn-csv" onclick="exportDatabaseToCSV()"><i class="fas fa-file-csv"></i> DOWNLOAD CSV (UNTUK GOOGLE SHEETS)</button>
    </div>
</div>

<div id="resultModal" class="modal" onclick="document.getElementById('resultModal').style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <button class="close-modal" onclick="document.getElementById('resultModal').style.display='none'"><i class="fas fa-times"></i></button>
        <div class="modal-title"><i class="fas fa-clipboard-list"></i> PREVIEW JADWAL</div>
        <div id="modalDateRange" class="preview-date">BERLAKU: -</div>
        <textarea id="resultText" class="preview-textarea" readonly></textarea>
        <button class="btn-action-copy" onclick="finalCopy()"><i class="fas fa-copy"></i> SALIN SEMUA TEKS</button>
    </div>
</div>

<div class="container">
    <div class="header-area">
        <h2>PLATFORM SCHEDULER V22.0 AI</h2>
        
        <div class="date-range-wrapper">
            <div class="date-input-group">
                <label>DARI TANGGAL</label>
                <input type="date" id="startDateInput" onchange="updateEndDate(); liveUpdateView()">
            </div>
            <div class="arrow-separator">âž¡</div>
            <div class="date-input-group">
                <label>SAMPAI TANGGAL</label>
                <input type="text" id="endDateDisplay" readonly placeholder="Otomatis...">
            </div>
        </div>

        <div id="displayDate">READY TO SYNC</div>
    </div>
    
    <details class="time-settings" id="timeSettings">
        <summary><i class="fas fa-clock"></i> PENGATURAN JAM (EDITABLE)</summary>
        <div class="time-inputs">
            <div class="time-group"><label>MIDNIGHT</label><input type="text" id="timeMidnight" value="00:00 - 06:00 WIB" onchange="updateUrlState()"></div>
            <div class="time-group"><label>SIANG</label><input type="text" id="timeSiang" value="06:00 - 15:00 WIB" onchange="updateUrlState()"></div>
            <div class="time-group"><label>SORE</label><input type="text" id="timeSore" value="15:00 - 19:00 WIB" onchange="updateUrlState()"></div>
            <div class="time-group"><label>MALAM</label><input type="text" id="timeMalam" value="19:00 - 00:00 WIB" onchange="updateUrlState()"></div>
        </div>
    </details>

    <div class="controls">
        <select id="profileSelect" onchange="changeProfileHandler()">
            <option value="CAPTAIN77">CAPTAIN77</option>
            <option value="PLAY77">PLAY77</option>
            <option value="JAGUAR77">JAGUAR77</option>
            <option value="FUN77">FUN77</option>
            <option value="INDOPEDIA77">INDOPEDIA77</option>
            <option value="INDOFUN17">INDOFUN17</option>
            <option value="HOLYPLAY17">HOLYPLAY17</option>
            <option value="MUSTANG77">MUSTANG77</option>
        </select>
        
        <button id="lockBtn" onclick="toggleLock()" title="Kunci Tombol Sync"><i class="fas fa-unlock"></i></button>
        <button id="genBtn" onclick="initiateSync()">SYNC DATA</button>
        <button id="copyAllBtn" onclick="copyFullWeek()" title="Salin Semua Hari"><i class="fas fa-copy"></i> MINGGUAN</button>

        <button id="dbBtn" onclick="openDatabaseModal()"><i class="fas fa-database"></i> DATABASE SEED</button>
        <button id="shareBtn" onclick="copyShareLink()" title="Copy Link Manual"><i class="fas fa-link"></i> LINK</button>
        
        <button id="designerBtn" onclick="toggleDesignerMode()" title="Mode Baca Mudah untuk Designer">
            <i class="fas fa-eye"></i> MODE DESIGNER
        </button>
    </div>

    <div id="capture-area"><div id="hasil"></div></div>
</div>

<script>
// --- ALGORITMA RNG MULBERRY32 ---
let currentSeed = Date.now(); 

function mulberry32(a) {
    return function() {
        var t = a += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    }
}

function seedRandom(seed) {
    return mulberry32(seed);
}

let myRandom = Math.random; 

function shuffleArray(array) {
    let currentIndex = array.length, randomIndex;
    while (currentIndex != 0) {
        randomIndex = Math.floor(myRandom() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
    }
    return array;
}

// --- INTELLIGENT THEME LOGIC ---
function getGameTheme(gameName) {
    if (!gameName) return "";
    let n = gameName.toLowerCase();
    
    // Manual overrides untuk seri game populer
    if(n.includes("olympus")) return "olympus";
    if(n.includes("starlight")) return "starlight";
    if(n.includes("bonanza")) return "bonanza";
    if(n.includes("mahjong")) return "mahjong";
    if(n.includes("neko")) return "neko";
    if(n.includes("aztec")) return "aztec";
    if(n.includes("thor")) return "thor";
    if(n.includes("wild bandito")) return "bandito";
    if(n.includes("sugar")) return "sugar";
    if(n.includes("gatot")) return "gatot";
    if(n.includes("princess")) return "princess"; // Backup jika tidak ada starlight
    
    // Default: Ambil kata pertama
    return n.split(" ")[0];
}

// --- DATABASE & HISTORY SYSTEM (LOCAL STORAGE) ---
function saveSeedToStorage(profile, seed, dateStart) {
    let db = JSON.parse(localStorage.getItem('schedulerDB') || "[]");
    const exists = db.some(item => item.seed === seed && item.profile === profile);
    if(exists) return;

    const newItem = {
        id: Date.now(),
        profile: profile,
        seed: seed,
        dateStart: dateStart,
        timestamp: new Date().toLocaleString('id-ID')
    };
    
    db.unshift(newItem);
    if(db.length > 100) db.pop();
    
    localStorage.setItem('schedulerDB', JSON.stringify(db));
}

function openDatabaseModal() {
    renderDatabase();
    document.getElementById('dbModal').style.display = 'flex';
}

function renderDatabase() {
    let db = JSON.parse(localStorage.getItem('schedulerDB') || "[]");
    const tableBody = document.getElementById('dbTableBody');
    const searchVal = document.getElementById('dbSearch').value.toLowerCase();
    const filterVal = document.getElementById('dbFilter').value;

    let html = `<thead><tr><th>WEB</th><th>TANGGAL BERLAKU</th><th>WAKTU GENERATE</th><th style="width: 100px; text-align:center;">AKSI</th></tr></thead><tbody>`;
    
    const filtered = db.filter(item => {
        const matchSearch = item.profile.toLowerCase().includes(searchVal) || item.dateStart.toLowerCase().includes(searchVal);
        const matchFilter = filterVal === "" || item.profile === filterVal;
        return matchSearch && matchFilter;
    });

    if(filtered.length === 0) {
        html += `<tr><td colspan="4" style="text-align:center; padding: 20px; color: #666;">BELUM ADA DATA</td></tr>`;
    } else {
        filtered.forEach(item => {
            html += `
            <tr>
                <td style="color:var(--primary); font-weight:bold;">${item.profile}</td>
                <td>${item.dateStart}</td>
                <td>${item.timestamp}</td>
                <td>
                    <div class="db-action-group">
                        <button class="btn-db-action btn-db-load" onclick="loadFromDatabase(${item.seed}, '${item.profile}', '${item.dateStart}')"><i class="fas fa-upload"></i> LOAD</button>
                        <button class="btn-db-action btn-db-del" onclick="deleteFromDatabase(${item.id})"><i class="fas fa-times"></i></button>
                    </div>
                </td>
            </tr>`;
        });
    }
    html += `</tbody>`;
    tableBody.innerHTML = html;
}

function loadFromDatabase(seed, profile, dateStart) {
    currentSeed = parseInt(seed);
    myRandom = seedRandom(currentSeed);
    document.getElementById("profileSelect").value = profile;
    document.getElementById("startDateInput").value = dateStart;
    updateEndDate();
    changeTheme();
    updateUrlState();
    document.getElementById('dbModal').style.display = 'none';
    fetchDatabase();
    showToast(`LOADED: ${profile}`);
}

function deleteFromDatabase(id) {
    if(!confirm("Hapus data ini dari riwayat?")) return;
    let db = JSON.parse(localStorage.getItem('schedulerDB') || "[]");
    db = db.filter(item => item.id !== id);
    localStorage.setItem('schedulerDB', JSON.stringify(db));
    renderDatabase();
}

function exportDatabaseToCSV() {
    let db = JSON.parse(localStorage.getItem('schedulerDB') || "[]");
    if(db.length === 0) { showToast("DATABASE KOSONG!"); return; }
    let csvContent = "data:text/csv;charset=utf-8,ID,WEBSITE,TANGGAL_BERLAKU,SEED_CODE,TIMESTAMP\n"; 
    db.forEach(row => { csvContent += `${row.id},${row.profile},${row.dateStart},${row.seed},${row.timestamp}\n`; });
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "database_seed_scheduler.csv");
    document.body.appendChild(link);
    link.click();
}

function updateEndDate() {
    const startVal = document.getElementById("startDateInput").value;
    if (!startVal) return;
    const startDate = new Date(startVal);
    const endDate = new Date(startDate);
    endDate.setDate(startDate.getDate() + 6);
    const options = { day: 'numeric', month: 'short', year: 'numeric' };
    document.getElementById("endDateDisplay").value = endDate.toLocaleDateString('id-ID', options).toUpperCase();
}

function liveUpdateView() {
    myRandom = seedRandom(currentSeed); 
    updateUrlState();
    generateJadwal(); 
    showToast("TANGGAL DIPERBARUI");
}

function updateUrlState() {
    const profile = document.getElementById("profileSelect").value;
    const inputDate = document.getElementById("startDateInput").value;
    const tM = encodeURIComponent(document.getElementById('timeMidnight').value);
    const tS = encodeURIComponent(document.getElementById('timeSiang').value);
    const tSo = encodeURIComponent(document.getElementById('timeSore').value);
    const tMa = encodeURIComponent(document.getElementById('timeMalam').value);
    let newUrl = `${window.location.pathname}?profile=${profile}&seed=${currentSeed}&tM=${tM}&tS=${tS}&tSo=${tSo}&tMa=${tMa}`;
    if(inputDate) newUrl += `&date=${inputDate}`;
    window.history.pushState({path: newUrl}, '', newUrl);
}

function changeProfileHandler() { 
    changeTheme(); 
    liveUpdateView(); 
}

function triggerScanEffect(callback) {
    const overlay = document.getElementById('scanOverlay');
    const bar = document.getElementById('scanBar');
    const txt = document.getElementById('scanText');
    const detail = document.getElementById('scanDetail');
    overlay.style.display = 'flex';
    let progress = 0;
    const processes = ["CONNECTING SERVER...", "BYPASSING FIREWALL...", "CALCULATING RTP...", "ANALYZING PATTERNS...", "INJECTING ALGORITHM...", "FINALIZING DATA..."];
    const interval = setInterval(() => {
        progress += Math.random() * 5; 
        if (progress > 100) progress = 100;
        bar.style.width = progress + "%";
        let processIndex = Math.floor((progress / 100) * processes.length);
        if(processes[processIndex]) txt.innerText = processes[processIndex];
        detail.innerText = "CODE: " + Math.floor(Math.random() * 999999);
        if (progress === 100) {
            clearInterval(interval);
            setTimeout(() => {
                overlay.style.display = 'none';
                if (callback) callback(); 
            }, 500); 
        }
    }, 50); 
}

function initiateSync() {
    triggerScanEffect(() => {
        const prof = document.getElementById("profileSelect").value;
        const date = document.getElementById("startDateInput").value;
        currentSeed = Date.now();
        saveSeedToStorage(prof, currentSeed, date);
        myRandom = seedRandom(currentSeed); 
        updateUrlState();
        fetchDatabase(); 
        showToast("DATA BARU & TERSIMPAN!");
    });
}

function copyShareLink() {
    updateUrlState(); 
    const url = window.location.href;
    if (!url.includes("seed=")) { showToast("KLIK 'SYNC DATA' DULU!"); return; }
    navigator.clipboard.writeText(url).then(() => { showToast("LINK TERSALIN! SIAP DIBAGIKAN"); });
}

let isLocked = false;
function toggleLock() {
    isLocked = !isLocked;
    const lockBtn = document.getElementById("lockBtn");
    const genBtn = document.getElementById("genBtn");
    const dateInput = document.getElementById("startDateInput");
    if (isLocked) {
        lockBtn.innerHTML = '<i class="fas fa-lock"></i>';
        lockBtn.classList.add("locked");
        genBtn.disabled = true; genBtn.style.opacity = "0.5"; genBtn.style.cursor = "not-allowed";
        dateInput.disabled = true;
    } else {
        lockBtn.innerHTML = '<i class="fas fa-unlock"></i>';
        lockBtn.classList.remove("locked");
        genBtn.disabled = false; genBtn.style.opacity = "1"; genBtn.style.cursor = "pointer";
        dateInput.disabled = false;
    }
}

function toggleDesignerMode() {
    const body = document.body;
    const btn = document.getElementById("designerBtn");
    body.classList.toggle("clean-mode");
    if (body.classList.contains("clean-mode")) {
        btn.innerHTML = '<i class="fas fa-paint-brush"></i> KEMBALI KE NEON';
        showToast("MODE DESIGNER: AKTIF");
        document.addEventListener('mousemove', handleTooltip);
    } else {
        btn.innerHTML = '<i class="fas fa-eye"></i> MODE DESIGNER';
        showToast("MODE NEON: KEMBALI");
        document.removeEventListener('mousemove', handleTooltip);
        document.getElementById('hover-tooltip').style.display = 'none';
    }
}

function handleTooltip(e) {
    if (!document.body.classList.contains('clean-mode')) return;
    const target = e.target.closest('.game-card');
    const tooltip = document.getElementById('hover-tooltip');
    const tooltipImg = document.getElementById('tooltip-img');
    if (target) {
        const name = target.querySelector('.game-name').innerText;
        if (gameImageMap[name]) {
            tooltipImg.src = gameImageMap[name];
            tooltip.style.display = 'block';
            tooltip.style.top = (e.clientY + 15) + 'px';
            tooltip.style.left = (e.clientX + 15) + 'px';
        }
    } else {
        tooltip.style.display = 'none';
    }
}

function showToast(msg) {
    const toast = document.getElementById("customToast");
    document.getElementById("toastMsg").innerText = msg;
    toast.classList.add("show");
    setTimeout(() => { toast.classList.remove("show"); }, 3000);
}

// --- VISUALS ---
const bgCanvas = document.getElementById('nebula-canvas'); const bgCtx = bgCanvas.getContext('2d');
const cursorCanvas = document.getElementById('cursor-canvas'); const cCtx = cursorCanvas.getContext('2d');
const pCanvas = document.getElementById('particle-canvas'); const pCtx = pCanvas.getContext('2d');
let w, h, nebulaLayers = [], stars = [], cursorParticles = [], mouse = { x: 0, y: 0 };
let animationFrameId;

document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
        cancelAnimationFrame(animationFrameId); 
    } else {
        loopVisuals();
    }
});

function initVisuals() {
    resize(); window.addEventListener('resize', resize);
    window.addEventListener('mousemove', (e) => { mouse.x = e.clientX; mouse.y = e.clientY; spawnCursorTrail(); });
    const isMobile = window.innerWidth < 700;
    const starCount = isMobile ? 50 : 150; 
    const layerCount = isMobile ? 3 : 5;
    nebulaLayers = []; stars = [];
    for(let i=0; i<layerCount; i++) nebulaLayers.push({ x: Math.random()*w, y: Math.random()*h, r: Math.random()*300+300, vx: (Math.random()-0.5)*0.5, vy: (Math.random()-0.5)*0.5, c: Math.floor(Math.random()*(currentNebulaColors.length-1)+1) });
    for(let i=0; i<starCount; i++) stars.push({ x: Math.random()*w, y: Math.random()*h, s: Math.random()*2, a: Math.random(), vx: (Math.random()-0.5)*0.1, vy: (Math.random()-0.5)*0.1 });
    loopVisuals();
}
function resize() { w = window.innerWidth; h = window.innerHeight; bgCanvas.width = cursorCanvas.width = pCanvas.width = w; bgCanvas.height = cursorCanvas.height = pCanvas.height = h; }
function spawnCursorTrail() { 
    if(cursorParticles.length > 20) return;
    for(let i=0; i<1; i++) cursorParticles.push({ x: mouse.x, y: mouse.y, vx: (Math.random()-0.5)*2, vy: (Math.random()-0.5)*2, life: 1, c: currentNebulaColors[1], s: Math.random()*3+1 }); 
}

function loopVisuals() {
    if (document.body.classList.contains('clean-mode')) { animationFrameId = requestAnimationFrame(loopVisuals); return; }
    bgCtx.fillStyle = currentNebulaColors[0]; bgCtx.fillRect(0,0,w,h);
    nebulaLayers.forEach(l => {
        l.x+=l.vx; l.y+=l.vy; if(l.x<-l.r)l.x=w+l.r; if(l.x>w+l.r)l.x=-l.r; if(l.y<-l.r)l.y=h+l.r; if(l.y>h+l.r)l.y=-l.r;
        let g = bgCtx.createRadialGradient(l.x,l.y,0,l.x,l.y,l.r); g.addColorStop(0, hexToRgba(currentNebulaColors[l.c]||currentNebulaColors[1],0.2)); g.addColorStop(1,'transparent');
        bgCtx.fillStyle=g; bgCtx.beginPath(); bgCtx.arc(l.x,l.y,l.r,0,Math.PI*2); bgCtx.fill();
    });
    pCtx.clearRect(0,0,w,h);
    stars.forEach(s => { s.x+=s.vx; s.y+=s.vy; if(s.x<0)s.x=w; if(s.x>w)s.x=0; if(s.y<0)s.y=h; if(s.y>h)s.y=0; s.a+=(Math.random()-0.5)*0.02; if(s.a<0)s.a=0; if(s.a>1)s.a=1; pCtx.fillStyle=`rgba(255,255,255,${s.a})`; pCtx.beginPath(); pCtx.arc(s.x,s.y,s.s,0,Math.PI*2); pCtx.fill(); });
    cCtx.clearRect(0,0,w,h); 
    cursorParticles.forEach((p,i) => { p.x+=p.vx; p.y+=p.vy; p.life-=0.05; p.s*=0.9; if(p.life>0){ cCtx.globalAlpha=p.life; cCtx.fillStyle=p.c; cCtx.beginPath(); cCtx.arc(p.x,p.y,p.s,0,Math.PI*2); cCtx.fill(); } else cursorParticles.splice(i,1); });
    animationFrameId = requestAnimationFrame(loopVisuals);
}
function hexToRgba(hex,a) { let r=parseInt(hex.slice(1,3),16), g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16); return `rgba(${r},${g},${b},${a})`; }

const PROFILE_CONFIG = {
    "CAPTAIN77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=0&single=true&output=csv",
    "JAGUAR77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=1165225864&single=true&output=csv",
    "INDOPEDIA77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=288756155&single=true&output=csv",
    "FUN77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=288756155&single=true&output=csv",
    "PLAY77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=410917478&single=true&output=csv",
    "MUSTANG77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=1769820056&single=true&output=csv",
    "HOLYPLAY17": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=265631998&single=true&output=csv",
    "INDOFUN17": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=2086618792&single=true&output=csv"
};

const THEMES = {
    "CAPTAIN77": { primary: "#00f2ff", nebula: ["#000000", "#000428", "#004e92", "#00f2ff"] },
    "PLAY77": { primary: "#3b82f6", nebula: ["#000000", "#020024", "#090979", "#3b82f6"] },
    "JAGUAR77": { primary: "#FFD700", nebula: ["#000000", "#1c1003", "#4a3b00", "#FFD700"] },
    "FUN77": { primary: "#ff3e3e", nebula: ["#000000", "#220000", "#430000", "#ff3e3e"] },
    "INDOPEDIA77": { primary: "#4ade80", nebula: ["#000000", "#022c22", "#064e3b", "#4ade80"] },
    "INDOFUN17": { primary: "#ff0055", nebula: ["#000000", "#330011", "#80002a", "#ff0055"] },
    "HOLYPLAY17": { primary: "#d8b4fe", nebula: ["#000000", "#1e0033", "#581c87", "#d8b4fe"] },
    "MUSTANG77": { primary: "#00ff88", nebula: ["#000000", "#001a00", "#003300", "#004d00"] }
};

let currentNebulaColors = THEMES["CAPTAIN77"].nebula;
let poolPragmatic = { gold:[], silver:[], bronze:[], guide:[] };
let poolPGSoft = { gold:[], silver:[], bronze:[], guide:[] };
let gameImageMap = {};
let depositSettings = { "MIDNIGHT":[], "SIANG":[], "SORE":[], "MALAM":[] };
let globalMemory = [];
let uniqueCodePool = [];

function changeTheme() {
    const selected = document.getElementById("profileSelect").value;
    const theme = THEMES[selected] || THEMES["CAPTAIN77"];
    document.documentElement.style.setProperty('--primary', theme.primary);
    currentNebulaColors = theme.nebula;
}

function checkUrlParams() {
    const urlParams = new URLSearchParams(window.location.search);
    const seed = urlParams.get('seed');
    const profile = urlParams.get('profile');
    const dateParam = urlParams.get('date');
    const tM = urlParams.get('tM');
    const tS = urlParams.get('tS');
    const tSo = urlParams.get('tSo');
    const tMa = urlParams.get('tMa');

    if(tM) document.getElementById('timeMidnight').value = decodeURIComponent(tM);
    if(tS) document.getElementById('timeSiang').value = decodeURIComponent(tS);
    if(tSo) document.getElementById('timeSore').value = decodeURIComponent(tSo);
    if(tMa) document.getElementById('timeMalam').value = decodeURIComponent(tMa);

    if (seed && profile) {
        currentSeed = parseInt(seed); 
        myRandom = seedRandom(currentSeed); 
        document.getElementById("profileSelect").value = profile;
        if(dateParam) {
            document.getElementById("startDateInput").value = dateParam;
            updateEndDate(); 
        }
        changeProfileHandler(); 
        fetchDatabase();
    } else {
        currentSeed = Date.now();
        myRandom = Math.random;
        document.getElementById("startDateInput").valueAsDate = new Date();
        updateEndDate(); 
        if(!tM && !tS) loadTimeSettings(); 
        updateUrlState(); 
    }
}

async function fetchDatabase() {
    const selected = document.getElementById("profileSelect").value;
    const btn = document.getElementById("genBtn");
    btn.disabled = true; btn.innerText = "LOADING...";
    try {
        const response = await fetch(PROFILE_CONFIG[selected]);
        const data = await response.text();
        const lines = data.split(/\r?\n/).filter(l => l.trim() !== "");
        poolPragmatic = { gold:[], silver:[], bronze:[], guide:[] };
        poolPGSoft = { gold:[], silver:[], bronze:[], guide:[] };
        gameImageMap = {};
        depositSettings = { "MIDNIGHT":[], "SIANG":[], "SORE":[], "MALAM":[] };
        lines.slice(1).forEach(line => {
            let cleanLine = line.replace(/"/g, ''); 
            let cols = cleanLine.split(',').map(c => c.trim());
            if (cols.length >= 3) {
                const prov = cols[0]; const tier = cols[1].toUpperCase(); const name = cols[2]; 
                let meta = cols[3] || ""; let extra = cols[4] || ""; 
                if (!meta.includes('|') && extra !== "") { meta = meta + "|" + extra; }
                meta = meta.replace(/\*\*/g, '');
                if (prov === "SETTING" && tier.startsWith("DEPO_")) {
                    const sess = tier.replace("DEPO_", "");
                    if (depositSettings[sess]) depositSettings[sess].push({ range: name, info: meta });
                } else if (name && name !== "") {
                    if (meta && !meta.includes('|')) gameImageMap[name] = meta; 
                    const t = cols[1].toLowerCase();
                    if (prov === "Pragmatic") { if(t==='guide') poolPragmatic.guide.push(name); else if(poolPragmatic[t]) poolPragmatic[t].push(name); }
                    else if (prov === "PGSoft") { if(t==='guide') poolPGSoft.guide.push(name); else if(poolPGSoft[t]) poolPGSoft[t].push(name); }
                }
            }
        });
        myRandom = seedRandom(currentSeed); 
        generateJadwal();
        btn.disabled = false; btn.innerText = "SYNC DATA";
        if(isLocked) btn.disabled = true;
    } catch (e) {
        alert("Gagal mengambil data! Cek koneksi.");
        btn.disabled = false; btn.innerText = "RETRY";
    }
}

function getUniqueCode() {
    if (uniqueCodePool.length === 0) {
        uniqueCodePool = [1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000];
        shuffleArray(uniqueCodePool);
    }
    return uniqueCodePool.pop();
}

function getStrategy(prov) {
    let list = (prov === 'Pragmatic') ? poolPragmatic.guide : poolPGSoft.guide;
    if (!list || list.length === 0) return { html: "<div>Pola Kurang</div>", text: "" };

    let headerText = "BET NOMINAL BEBAS";
    let headerHtml = `<div style="color: #fff; font-size: 10px; margin-bottom: 3px; font-weight: bold; letter-spacing:1px; text-transform:uppercase;">${headerText}</div>`;
    
    let dcText = "";
    let badgeHtml = "";
    if (prov === 'Pragmatic') {
        const state = myRandom() > 0.5 ? "ON" : "OFF";
        dcText = `FITUR GANDA ${state}`;
        badgeHtml = `<span class="badge" style="background:var(--primary); color:#000; margin-bottom:5px; display:inline-block;">${dcText}</span>`;
    }

    let selected = [];
    
    // Helper untuk mengenali tipe pola
    const getType = (str) => {
        let clean = str.toUpperCase();
        if (clean.includes("MANUAL")) return "MANUAL";
        if (clean.includes("AUTO")) return "AUTO"; 
        if (clean.includes("TURBO")) return "TURBO";
        if (clean.includes("BUY") || clean.includes("BELI")) return "BUY";
        return "OTHER";
    };

    if (prov === 'Pragmatic') {
        let buySpinList = list.filter(item => getType(item) === "BUY");
        let normalList = list.filter(item => getType(item) !== "BUY");
        
        if (normalList.length === 0) normalList = [...list];

        // LOGIKA BARU: GROUPING BERDASARKAN TIPE
        let grouped = {};
        normalList.forEach(item => {
            let t = getType(item);
            if(!grouped[t]) grouped[t] = [];
            grouped[t].push(item);
        });
        
        let availableTypes = Object.keys(grouped); // ['MANUAL', 'AUTO', 'TURBO']

        // Loop 5 kali untuk pola normal
        for(let i=0; i<5; i++) {
            let forbiddenType = (selected.length > 0) ? getType(selected[selected.length-1]) : null;
            let validPool = [];

            // Kumpulkan semua item yang BUKAN tipe sebelumnya
            availableTypes.forEach(t => {
                if(t !== forbiddenType) {
                    validPool = validPool.concat(grouped[t]);
                }
            });

            // Jika pool kosong (misal cuma ada 1 tipe data), terpaksa pakai semua normalList
            if(validPool.length === 0) validPool = normalList;

            // Prioritaskan yang belum terpilih (Text Unik)
            let uniquePool = validPool.filter(item => !selected.includes(item));
            if(uniquePool.length > 0) validPool = uniquePool;

            let chosen = validPool[Math.floor(myRandom() * validPool.length)];
            selected.push(chosen);
        }

        // Tambah Buy Spin di akhir
        let buyItem = buySpinList.length > 0 ? buySpinList[Math.floor(myRandom() * buySpinList.length)] : "POLA KHUSUS: BUY SPIN SECUKUPNYA";
        selected.push(buyItem);

    } else {
        // PG SOFT LOGIC (Mirip Pragmatic, tapi tanpa buy spin)
        let normalList = [...list];
        let grouped = {};
        normalList.forEach(item => {
            let t = getType(item);
            if(!grouped[t]) grouped[t] = [];
            grouped[t].push(item);
        });
        let availableTypes = Object.keys(grouped);

        for(let i=0; i<5; i++) {
            let forbiddenType = (selected.length > 0) ? getType(selected[selected.length-1]) : null;
            let validPool = [];
            
            availableTypes.forEach(t => {
                if(t !== forbiddenType) validPool = validPool.concat(grouped[t]);
            });

            if(validPool.length === 0) validPool = normalList;
            
            let uniquePool = validPool.filter(item => !selected.includes(item));
            if(uniquePool.length > 0) validPool = uniquePool;

            let chosen = validPool[Math.floor(myRandom() * validPool.length)];
            selected.push(chosen);
        }
    }

    let stepsHtml = selected.map(s => `
        <div class="step-row">
            <span class="step-text">${s}</span>
            <button class="delete-item-btn" onclick="removeElement(this, event)" title="Hapus Pola Ini"><i class="fas fa-times"></i></button>
        </div>`
    ).join('');

    const footerMsg = "NAIKAN BET SECARA BERTAHAP & ULANGI POLA";
    let footerHtml = `<div class="step-row" style="margin-top:5px; border-top:1px dashed #444; padding-top:5px; justify-content:center;"><span style="color:var(--warn-yellow); font-weight:800; font-size:9px;">${footerMsg}</span></div>`;
    
    return { html: `<div class="guide-container">${headerHtml}${badgeHtml}${stepsHtml}${footerHtml}</div>`, text: "" };
}

function getDeposit(sess) {
    let tail = getUniqueCode();
    
    // AMBIL DATA & LOGIKA BARU UNTUK FUN77
    let data = depositSettings[sess];
    const currentProfile = document.getElementById("profileSelect").value;

    // JIKA FUN77, HANYA AMBIL 1 DATA PERTAMA
    if (currentProfile === "FUN77" && data && data.length > 0) {
        data = [data[0]]; 
    }

    if (!data || data.length === 0) return { html: "", text: "", code: tail };
    
    let html = `<div class="depo-container"><div class="depo-header">KODE JITU EKOR: ${tail}</div>`;
    let text = "";
    const processValue = (rawStr) => {
        if (!rawStr) return 0;
        let cleanStr = rawStr.toString().replace(/\D/g, ''); 
        let num = parseInt(cleanStr) || 0;
        return (Math.floor(num / 1000) * 1000) + tail;
    };
    data.forEach((item, i) => {
        let parts = item.range.split('-');
        let meta = item.info.split('|');
        let bonus = meta[0] || "UNK";
        let rate = meta[1] || "90%";
        let minVal = processValue(parts[0]);
        let maxVal = parts.length === 2 ? processValue(parts[1]) : 0;
        let nominal = parts.length === 2 ? `DEPO Rp ${minVal.toLocaleString()} - Rp ${maxVal.toLocaleString()}` : `SPECIAL DEPO Rp ${minVal.toLocaleString()}`;
        html += `<div class="depo-item"><span class="depo-info">${i+1}. ${nominal}</span><div class="depo-meta"><span class="tag-bonus">BONUS ${bonus}</span><span class="tag-rate">RATE ${rate}</span></div></div>`;
        text += `${i+1}. ${nominal} (Bonus ${bonus} | Rate ${rate})\n`;
    });
    html += `</div>`;
    return { html, text, code: tail };
}

// UPDATE: pickGame now accepts session history logic
function pickGame(prov, tier, blacklist, daily, previousThemes, currentThemes, yesterdaySameSessionThemes) {
    let list = (prov === 'Pragmatic') ? poolPragmatic[tier] : poolPGSoft[tier];
    if (!list || list.length === 0) return { name: "DATA KOSONG", html: "", theme: "" };
    
    // Filter games (Logic Anti-Kembar V22)
    const filterGames = (strictLevel) => {
        return list.filter(g => {
            let theme = getGameTheme(g);
            if (blacklist.includes(g)) return false; 
            if (strictLevel > 1 && daily.includes(g)) return false; 
            if (strictLevel > 2 && currentThemes.includes(theme)) return false;
            if (strictLevel > 3 && previousThemes.includes(theme)) return false;
            if (strictLevel > 4 && yesterdaySameSessionThemes && yesterdaySameSessionThemes.includes(theme)) return false;
            return true;
        });
    };

    let available = [];
    for (let level = 5; level >= 1; level--) {
        available = filterGames(level);
        if (available.length > 0) break;
    }

    if (available.length === 0) {
        available = list.filter(g => !blacklist.includes(g)); 
        if (available.length === 0) available = list;
    }

    const chosen = available[Math.floor(myRandom() * available.length)];
    const chosenTheme = getGameTheme(chosen);
    let badgeColor = tier==='gold'?'#ffd700':tier==='silver'?'#c0c0c0':'#cd7f32';
    
    // REVISI: TOMBOL DELETE DIHAPUS DARI SINI
    return { 
        name: chosen, 
        theme: chosenTheme,
        html: `<div class="game-card" onclick="showImg('${chosen}')">
                <span class="game-name">${chosen}</span>
                <span class="badge" style="background:${badgeColor};color:#000">${tier}</span>
               </div>` 
    };
}

function resolveGameCounts(profile, sessionName) {
    const r = myRandom(); 
    if (profile === "CAPTAIN77") {
        if(sessionName === "MIDNIGHT") return { pp:3, pg:2 };
        if(sessionName === "SIANG") return { pp:2, pg:2 };
        if(sessionName === "SORE") return { pp:2, pg:0 };
        if(sessionName === "MALAM") return r > 0.5 ? { pp:1, pg:0 } : { pp:0, pg:1 };
    } else if (profile === "JAGUAR77") {
        if(sessionName === "MIDNIGHT") return { pp:3, pg:2 };
        if(sessionName === "SIANG") return { pp:2, pg:2 };
        if(sessionName === "SORE") return r > 0.5 ? { pp:2, pg:0 } : { pp:1, pg:1 };
        if(sessionName === "MALAM") return r > 0.5 ? { pp:1, pg:0 } : { pp:0, pg:1 };
    } else if (profile === "FUN77") {
        if(sessionName === "MIDNIGHT") return { pp:3, pg:2 };
        if(sessionName === "SIANG") return { pp:2, pg:2 };
        // UPDATE LOGIKA SORE: 2 PP atau 1 PP (Tanpa PG Soft)
        if(sessionName === "SORE") return r > 0.5 ? { pp:2, pg:0 } : { pp:1, pg:0 };
        if(sessionName === "MALAM") return { pp:1, pg:1 };
    } else if (profile === "MUSTANG77") {
        if(sessionName === "MIDNIGHT") return { pp:2, pg:2 };
        if(sessionName === "SIANG") return { pp:2, pg:2 };
        if(sessionName === "SORE") return { pp:1, pg:0 };
        if(sessionName === "MALAM") return { pp:0, pg:1 };
    } else if (profile === "INDOPEDIA77") {
        if(sessionName === "MIDNIGHT") return { pp:2, pg:2 };
        if(sessionName === "SIANG") return { pp:3, pg:3 };
        if(sessionName === "SORE") return r > 0.5 ? { pp:1, pg:0 } : { pp:2, pg:0 };
        if(sessionName === "MALAM") return r > 0.5 ? { pp:1, pg:0 } : { pp:0, pg:1 };
    } else if (profile === "HOLYPLAY17") {
        if(sessionName === "MIDNIGHT") return { pp:2, pg:2 };
        if(sessionName === "SIANG") return { pp:2, pg:2 };
        if(sessionName === "SORE") return { pp:2, pg:0 }; 
        if(sessionName === "MALAM") return { pp:0, pg:2 };
    } else if (profile === "INDOFUN17") {
        if(sessionName === "MIDNIGHT") return { pp:2, pg:2 };
        if(sessionName === "SIANG") return { pp:2, pg:2 };
        if(sessionName === "SORE") return { pp:2, pg:0 };
        if(sessionName === "MALAM") return { pp:0, pg:1 };
    } else if (profile === "PLAY77") {
        if(sessionName === "MIDNIGHT") return r > 0.5 ? { pp:2, pg:0 } : { pp:1, pg:0 };
        if(sessionName === "SIANG") return { pp:2, pg:2 };
        if(sessionName === "SORE") { if (r < 0.33) return { pp:1, pg:0 }; else if (r < 0.66) return { pp:2, pg:0 }; else return { pp:1, pg:1 }; }
        if(sessionName === "MALAM") return { pp:0, pg:1 };
    }
    return { pp:2, pg:2 };
}

function generateJadwal() {
    const profile = document.getElementById("profileSelect").value;
    const dateInputStr = document.getElementById('startDateInput').value;
    let startDate = dateInputStr ? new Date(dateInputStr) : new Date();
    let endDate = new Date(startDate); endDate.setDate(startDate.getDate() + 6);
    const options = { day: 'numeric', month: 'short', year: 'numeric' };
    const dateRangeStr = `${startDate.toLocaleDateString('id-ID', options)} - ${endDate.toLocaleDateString('id-ID', options)}`;
    document.getElementById('displayDate').innerText = `PERIODE: ${dateRangeStr.toUpperCase()}`;
    const times = {
        "MIDNIGHT": document.getElementById('timeMidnight').value,
        "SIANG": document.getElementById('timeSiang').value,
        "SORE": document.getElementById('timeSore').value,
        "MALAM": document.getElementById('timeMalam').value
    };
    const days = ["SENIN","SELASA","RABU","KAMIS","JUMAT","SABTU","MINGGU"];
    uniqueCodePool = []; 
    let html = "";
    globalMemory = [];
    let yesterday = [];
    
    // NEW: Store themes from previous day's specific sessions (e.g., Yesterday Midnight)
    let historyPerSession = { "MIDNIGHT": [], "SIANG": [], "SORE": [], "MALAM": [] };

    days.forEach((day, dayIndex) => {
        let currentDate = new Date(startDate); currentDate.setDate(startDate.getDate() + dayIndex);
        let dateBadge = currentDate.toLocaleDateString('id-ID', {day: '2-digit', month: '2-digit', year: '2-digit'});
        let todayGames = [];
        let dayData = { day: day, date: dateBadge, sessions: [] };
        
        let previousSessionThemes = []; // Reset setiap hari baru agar fresh
        let todaySessionThemes = { "MIDNIGHT": [], "SIANG": [], "SORE": [], "MALAM": [] }; // Store themes to pass to tomorrow

        const draw = (p, t, currentThemes, sessKey) => { 
            // Pass historyPerSession[sessKey] to pickGame
            let res = pickGame(p, t, yesterday, todayGames, previousSessionThemes, currentThemes, historyPerSession[sessKey]); 
            if (res.name !== "DATA KOSONG") todayGames.push(res.name); 
            return res; 
        }

        const buildSession = (label, sessKey, sessIndex) => {
            const timeStr = times[sessKey];
            const counts = resolveGameCounts(profile, sessKey);
            let sessionHtml = "";
            let rawTxt = "";
            let currentSessionThemes = [];

            if (counts.pp > 0) {
                let ppContent = ""; let ppText = "";
                for(let i=0; i<counts.pp; i++) {
                    // LOGIC CHANGE: FORCE GOLD IF SESSION IS "SORE"
                    let tier = (sessKey === "SORE") ? 'gold' : (i===0 ? 'gold' : (i===1 ? 'silver' : 'bronze'));
                    
                    let g = draw('Pragmatic', tier, currentSessionThemes, sessKey);
                    currentSessionThemes.push(g.theme); 
                    todaySessionThemes[sessKey].push(g.theme); // Save for tomorrow
                    ppContent += g.html; ppText += `${g.name}\n`;
                }
                let stP = getStrategy('Pragmatic');
                sessionHtml += `<div class="provider-label">PRAGMATIC PLAY</div>${ppContent}${stP.html}`;
                rawTxt += `--- PRAGMATIC PLAY ---\n${ppText}\nPOLA PRAGMATIC:\n${stP.text}\n\n`;
            }
            if (counts.pg > 0) {
                let pgContent = ""; let pgText = "";
                for(let i=0; i<counts.pg; i++) {
                    // LOGIC CHANGE: FORCE GOLD IF SESSION IS "SORE"
                    let tier = (sessKey === "SORE") ? 'gold' : (i===0 ? 'gold' : 'silver');

                    let g = draw('PGSoft', tier, currentSessionThemes, sessKey);
                    currentSessionThemes.push(g.theme);
                    todaySessionThemes[sessKey].push(g.theme); // Save for tomorrow
                    pgContent += g.html; pgText += `${g.name}\n`;
                }
                let stPg = getStrategy('PGSoft');
                sessionHtml += `<div class="provider-label">PG SOFT</div>${pgContent}${stPg.html}`;
                rawTxt += `--- PG SOFT ---\n${pgText}\nPOLA PG SOFT:\n${stPg.text}`;
            }
            
            // Simpan tema sesi ini untuk pengecekan sesi berikutnya (dalam hari yang sama)
            previousSessionThemes = [...currentSessionThemes];

            let depo = getDeposit(sessKey);
            dayData.sessions.push({ title: label, time: timeStr, games: rawTxt.trim(), depo: depo });
            return `
            <div class="session-box">
                <div class="session-header">
                    <div class="session-title">${label}</div>
                    <span class="session-time">${timeStr}</span>
                    <div class="action-container">
                        <button class="action-btn minimize-btn" onclick="toggleSession(this)"><i class="fas fa-window-minimize"></i></button>
                        <button class="action-btn copy-btn" onclick="copySession(${dayIndex}, ${sessIndex})"><i class="fas fa-copy"></i></button>
                    </div>
                </div>
                <div class="session-content">${sessionHtml}${depo.html}</div>
            </div>`;
        };
        html += `
        <div class="day-row">
            <div class="day-header">
                <span class="day-label">${day} <span class="date-badge">${dateBadge}</span></span>
                <button class="minimize-day-btn" onclick="toggleDay(this)" title="Toggle Hari"><i class="fas fa-window-minimize"></i></button>
            </div>
            <div class="session-grid">`;
        html += buildSession("ðŸŒ‘ MIDNIGHT", "MIDNIGHT", 0);
        html += buildSession("â˜€ï¸ SIANG", "SIANG", 1);
        html += buildSession("ðŸŒ‡ SORE", "SORE", 2);
        html += buildSession("ðŸŒ™ MALAM", "MALAM", 3);
        html += `</div></div>`;
        
        globalMemory.push(dayData);
        yesterday = [...todayGames];
        
        // Update historyPerSession with today's data for the next loop iteration (tomorrow)
        historyPerSession = todaySessionThemes;
    });
    document.getElementById("hasil").innerHTML = html;
}

function toggleSession(btn) {
    const box = btn.closest('.session-box'); box.classList.toggle('collapsed');
    const icon = btn.querySelector('i');
    if (box.classList.contains('collapsed')) { icon.classList.remove('fa-window-minimize'); icon.classList.add('fa-window-maximize'); } 
    else { icon.classList.remove('fa-window-maximize'); icon.classList.add('fa-window-minimize'); }
}

function toggleDay(btn) {
    const row = btn.closest('.day-row'); row.classList.toggle('collapsed');
    const icon = btn.querySelector('i');
    if (row.classList.contains('collapsed')) { icon.classList.remove('fa-window-minimize'); icon.classList.add('fa-window-maximize'); } 
    else { icon.classList.remove('fa-window-maximize'); icon.classList.add('fa-window-minimize'); }
}

function saveTimeSettings() {
    const settings = {
        midnight: document.getElementById('timeMidnight').value,
        siang: document.getElementById('timeSiang').value,
        sore: document.getElementById('timeSore').value,
        malam: document.getElementById('timeMalam').value
    };
    localStorage.setItem('schedulerTimeSettings', JSON.stringify(settings));
    liveUpdateView(); 
}
function loadTimeSettings() {
    const saved = localStorage.getItem('schedulerTimeSettings');
    if (saved) {
        const s = JSON.parse(saved);
        if(s.midnight) document.getElementById('timeMidnight').value = s.midnight;
        if(s.siang) document.getElementById('timeSiang').value = s.siang;
        if(s.sore) document.getElementById('timeSore').value = s.sore;
        if(s.malam) document.getElementById('timeMalam').value = s.malam;
    }
}

function openResultModal(text) {
    const modal = document.getElementById("resultModal");
    const txtArea = document.getElementById("resultText");
    const dateLabel = document.getElementById("modalDateRange");
    const dateStr = document.getElementById("displayDate").innerText.replace("PERIODE: ", "");
    dateLabel.innerText = "BERLAKU: " + dateStr;
    txtArea.value = text;
    modal.style.display = 'flex';
}

function finalCopy() {
    const txtArea = document.getElementById("resultText"); txtArea.select(); document.execCommand('copy'); showToast("TEKS BERHASIL DISALIN!");
}

// --- FITUR HAPUS & SMART COPY ---

// 1. Fungsi untuk menghapus elemen saat tombol X diklik
function removeElement(btn, event) {
    if(event) event.stopPropagation(); // Mencegah klik tembus ke game card
    const elementToRemove = btn.parentElement;
    
    // Animasi hapus sedikit agar smooth
    elementToRemove.style.opacity = '0';
    elementToRemove.style.transform = 'translateX(20px)';
    
    setTimeout(() => {
        elementToRemove.remove();
    }, 200);
}

// 2. Fungsi PINTAR untuk mengekstrak teks langsung dari LAYAR (DOM)
// Ini memastikan apa yang sudah dihapus tidak ikut tersalin
function extractTextFromDOM(sessionBox) {
    let result = "";
    
    // Ambil konten di dalam session-content
    const contentDiv = sessionBox.querySelector('.session-content');
    if (!contentDiv) return "";

    // Loop semua elemen anak
    const children = contentDiv.querySelectorAll('.provider-label, .game-card, .guide-container');
    
    children.forEach(child => {
        // Jika Header Provider (PRAGMATIC / PG SOFT)
        if (child.classList.contains('provider-label')) {
            result += `\n--- ${child.innerText} ---\n`;
        }
        // Jika Game Card
        else if (child.classList.contains('game-card')) {
            const gameName = child.querySelector('.game-name').innerText;
            result += `${gameName}\n`;
        }
        // Jika Pola (Guide Container)
        else if (child.classList.contains('guide-container')) {
            // Ambil header pola
            const header = child.innerText.split('\n')[0]; // Ambil baris pertama (BET NOMINAL...)
            result += `${header}\n`;
            
            // Cek ada badge DC ON/OFF gak
            const badge = child.querySelector('.badge');
            if (badge) result += `${badge.innerText}\n`;

            // Ambil langkah-langkah (step-row)
            const steps = child.querySelectorAll('.step-row .step-text');
            steps.forEach(step => {
                if (!step.innerText.includes("NAIKAN BET")) {
                    result += `> ${step.innerText}\n`;
                }
            });
            
            result += `\nNAIKAN BET SECARA BERTAHAP & ULANGI POLA\n`;
        }
    });

    return result.trim();
}

// 3. Override (Timpa) fungsi copySession yang lama
function copySession(dayIndex, sessIndex) {
    // Cari elemen session box di layar berdasarkan index
    const dayRows = document.querySelectorAll('.day-row');
    if (!dayRows[dayIndex]) return;
    
    const sessionBoxes = dayRows[dayIndex].querySelectorAll('.session-box');
    if (!sessionBoxes[sessIndex]) return;

    const targetBox = sessionBoxes[sessIndex];
    
    // Ambil data dasar
    const dayData = globalMemory[dayIndex];
    const sessionTitle = targetBox.querySelector('.session-title').innerText;
    const sessionTime = targetBox.querySelector('.session-time').innerText;
    
    // Generate Text Game & Pola DARI LAYAR (bukan dari memori)
    const gamesText = extractTextFromDOM(targetBox);

    // Ambil data Deposit (ini tetap dari memori karena strukturnya beda, kecuali mau dihapus juga)
    // Untuk saat ini deposit kita biarkan static dari memori
    const depoData = dayData.sessions[sessIndex].depo; 

    let txt = `=================================\n`;
    txt += `HARI: ${dayData.day}, ${dayData.date}\n`;
    txt += `SESI: ${sessionTitle} (${sessionTime})\n`;
    txt += `=================================\n\n`;
    txt += `${gamesText}\n\n`;
    txt += `---------------------------------\n`;
    txt += `KODE EKOR: ${depoData.code}\n`;
    txt += `---------------------------------\n`;
    txt += `LIST DEPOSIT:\n${depoData.text}`;

    openResultModal(txt);
}

// 4. Override (Timpa) fungsi copyFullWeek (jika kamu pakai fitur Mingguan)
function copyFullWeek() {
    if (globalMemory.length === 0) { showToast("DATA BELUM DI-SYNC!"); return; }
    
    let fullText = "";
    const headerTitle = document.querySelector('.header-area h2').innerText;
    const period = document.getElementById('displayDate').innerText;
    
    fullText += `=== ${headerTitle} ===\n${period}\n\n`;

    const dayRows = document.querySelectorAll('.day-row');
    
    dayRows.forEach((row, dIndex) => {
        const dayLabel = row.querySelector('.day-label').innerText;
        
        fullText += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
        fullText += `ðŸ“… ${dayLabel}\n`;
        fullText += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
        
        const sessions = row.querySelectorAll('.session-box');
        sessions.forEach((sessBox, sIndex) => {
            const title = sessBox.querySelector('.session-title').innerText;
            const time = sessBox.querySelector('.session-time').innerText;
            
            // Ambil text real-time dari layar
            const gamesTxt = extractTextFromDOM(sessBox);
            const depoCode = globalMemory[dIndex].sessions[sIndex].depo.code;

            fullText += `\n[ ${title} | ${time} ]\n`;
            fullText += `==============================\n`;
            fullText += `${gamesTxt}\n`;
            fullText += `------------------------------\n`;
            fullText += `KODE: ${depoCode}\n`;
        });
        fullText += `\n\n`;
    });

    openResultModal(fullText);
    showToast("PREVIEW MINGGUAN SIAP!");
}
window.onload = function() { checkUrlParams(); initVisuals(); };
</script>
</body>
</html>
