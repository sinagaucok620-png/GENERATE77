<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCHEDULER V24 LITE (Clean & Fast)</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #00f2ff;
            --glass-bg: #111;
            --glass-border: rgba(255, 255, 255, 0.1);
            --win-green: #00ff88;
            --warn-yellow: #ffd700;
            --danger-red: #ff3e3e;
        }

        * { box-sizing: border-box; } 

        body { 
            font-family: 'Rajdhani', sans-serif; 
            margin: 0; padding: 40px 20px;
            color: #fff; -webkit-font-smoothing: antialiased;
            min-height: 100vh; 
            background: linear-gradient(135deg, #050505 0%, #1a1a1a 100%); /* LITE BACKGROUND */
            overflow-x: hidden;
        }

        .container { 
            max-width: 1300px; margin: auto; 
            background: rgba(20, 20, 20, 0.95);
            padding: 40px; border-radius: 20px; 
            border: 1px solid var(--glass-border);
            box-shadow: 0 0 30px rgba(0,0,0,0.8); 
        }

        .header-area { 
            text-align: center; margin-bottom: 30px; 
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 20px;
        }
        .header-area h2 { 
            color: var(--primary); margin: 0 0 20px 0; font-size: 48px; font-weight: 800; 
            letter-spacing: 5px; text-transform: uppercase;
            text-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
        }
        
        .date-range-wrapper {
            display: inline-flex; align-items: flex-end; gap: 15px;
            background: rgba(0,0,0,0.3); padding: 15px 25px; border-radius: 12px;
            border: 1px solid var(--glass-border); margin-bottom: 10px;
        }
        .date-input-group { display: flex; flex-direction: column; gap: 5px; text-align: left; }
        .date-input-group label { font-size: 11px; color: var(--primary); font-weight: bold; letter-spacing: 1px; }
        .arrow-separator { font-size: 24px; color: #fff; padding-bottom: 8px; opacity: 0.5; }

        #displayDate { 
            color: #aaa; font-size: 12px; margin-top: 10px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase;
        }

        .controls { 
            display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap; 
            background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 20px;
            border: 1px solid var(--glass-border);
        }

        .time-settings {
            background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;
            margin-bottom: 30px; border: 1px dashed rgba(255,255,255,0.2);
            width: 100%; max-width: 1220px; margin: 0 auto 30px;
        }
        .time-settings summary { cursor: pointer; color: var(--warn-yellow); font-weight: bold; margin-bottom: 10px; outline: none; }
        .time-inputs { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 10px; }
        .time-group label { display: block; font-size: 10px; color: #aaa; margin-bottom: 3px; }
        .time-group input { width: 90%; font-size: 12px; padding: 8px; }

        input, select { 
            background: #222; color: #fff; border: 1px solid #444; 
            padding: 12px 20px; border-radius: 8px; font-size: 14px; outline: none; 
            font-family: 'Rajdhani', sans-serif; font-weight: 700; cursor: pointer;
        }
        input:focus, select:focus { border-color: var(--primary); background: #000; }
        input[type="date"] { text-transform: uppercase; color-scheme: dark; }
        input[readonly] { background: #111; color: #777; border-color: transparent; cursor: default; }

        button { 
            background: var(--primary); color: #000; border: none; 
            padding: 12px 25px; cursor: pointer; border-radius: 8px; font-weight: 800; 
            text-transform: uppercase; font-size: 14px; transition: 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 0 15px var(--primary); }
        button:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(100%); }
        
        #lockBtn { padding: 12px 15px; width: 50px; background: #333; color: #fff; }
        #lockBtn.locked { background: var(--danger-red); }
        #shareBtn { background: #6c5ce7; color: #fff; }
        #designerBtn { background: #fff; color: #000; border: 1px solid #999; }
        #dbBtn { background: #ff9f43; color: #000; }

        /* DAY & SESSION STYLES */
        .day-row { margin-bottom: 50px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .day-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; border-left: 5px solid var(--primary); padding-left: 15px; }
        .day-label { font-size: 28px; color: #fff; font-weight: 800; display: flex; align-items: center; gap: 15px; }
        .minimize-day-btn { background: #333; color: #fff; border: 1px solid #444; width: 35px; height: 35px; border-radius: 8px; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .day-row.collapsed .session-grid { display: none; }
        .day-row.collapsed { margin-bottom: 10px; border: none; padding-top: 10px; opacity: 0.6; }
        .date-badge { font-size: 16px; background: #333; padding: 5px 10px; border-radius: 6px; color: var(--primary); letter-spacing: 1px; font-family: monospace; }
        
        .session-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .session-box { 
            background: rgba(255,255,255,0.02); padding: 20px; border-radius: 15px; 
            border: 1px solid #333; height: 100%; position: relative; display: flex; flex-direction: column; overflow: hidden;
        }
        .session-box:hover { border-color: var(--primary); }
        .session-box.active-now { border-color: var(--primary); box-shadow: 0 0 10px rgba(0, 242, 255, 0.2); }

        .session-header { display: flex; flex-direction: column; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 10px; position: relative; }
        .action-container { position: absolute; top: 0; right: 0; display: flex; gap: 5px; }
        .action-btn { background: #222; color: #aaa; border: 1px solid #444; width: 28px; height: 28px; padding: 0; border-radius: 6px; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 11px; }
        .action-btn:hover { background: var(--primary); color: #000; }
        .session-content { transition: all 0.3s ease; opacity: 1; max-height: 2000px; }
        .session-box.collapsed .session-content { opacity: 0; max-height: 0; margin: 0; padding: 0; overflow: hidden; }
        .session-title { color: var(--primary); font-weight: 800; font-size: 16px; margin-bottom: 5px; text-transform: uppercase; }
        .session-time { font-size: 11px; color: #aaa; display: block; margin-bottom: 5px; font-family: monospace; }
        .provider-label { font-size: 10px; color: #888; font-weight: 700; margin: 15px 0 5px; text-transform: uppercase; letter-spacing: 1px; }

        .game-card { background: #222; padding: 10px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid transparent; transition: 0.2s; cursor: pointer; border-top: 1px solid #333; }
        .game-card:hover { border-color: var(--primary); background: var(--primary); }
        .game-card:hover .game-name { color: #000; }
        .game-name { font-size: 12px; font-weight: 700; color: #ddd; }
        .badge { font-size: 9px; padding: 2px 6px; border-radius: 4px; background: #000; border: 1px solid #333; }

        .depo-container { margin-top: auto; background: rgba(0,0,0,0.2); border: 1px dashed #444; border-radius: 10px; padding: 15px; }
        .depo-header { font-size: 11px; color: var(--primary); font-weight: 800; text-align: center; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .depo-item { margin-bottom: 8px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .depo-item:last-child { border: none; margin: 0; }
        .depo-info { font-size: 11px; color: #fff; display: block; margin-bottom: 3px; }
        .depo-meta { font-size: 10px; display: flex; justify-content: space-between; }
        .tag-bonus { color: #ff9f43; font-weight: 800; } .tag-rate { color: var(--win-green); font-weight: 800; }

        .guide-container { margin-top: 15px; padding: 10px; background: #1a1a1a; border-radius: 8px; }
        .step-row { font-size: 10px; color: #888; margin-bottom: 4px; border-bottom: 1px solid #333; padding-bottom: 2px; display: flex; justify-content: space-between; }

        .toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 10000; pointer-events: none; }
        .toast { background: #111; border: 2px solid var(--primary); color: var(--primary); padding: 15px 40px; border-radius: 50px; font-weight: 800; font-size: 14px; letter-spacing: 2px; text-transform: uppercase; box-shadow: 0 0 50px var(--primary); opacity: 0; transform: translateY(20px); transition: all 0.4s; display: flex; align-items: center; gap: 12px; }
        .toast.show { opacity: 1; transform: translateY(0); }

        #hover-tooltip { position: fixed; display: none; z-index: 10000; background: #000; border: 2px solid var(--primary); border-radius: 10px; padding: 5px; box-shadow: 0 0 20px rgba(0,0,0,0.8); pointer-events: none; max-width: 200px; }
        #hover-tooltip img { width: 100%; border-radius: 5px; }

        /* MODAL & DB STYLES */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: #111; padding: 25px; border: 1px solid var(--primary); border-radius: 15px; max-width: 600px; width: 90%; text-align: center; box-shadow: 0 0 30px var(--primary); position: relative; }
        .modal-content img { width: 100%; border-radius: 10px; margin-bottom: 10px; }
        .close-modal { position: absolute; top: 15px; right: 15px; color: #fff; background: none; border: 1px solid #444; width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .close-modal:hover { background: var(--danger-red); border-color: var(--danger-red); }
        
        .db-controls { display: flex; gap: 10px; margin-bottom: 15px; }
        .db-search { flex: 1; background: #222; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 6px; }
        .db-table-container { max-height: 300px; overflow-y: auto; text-align: left; }
        .db-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .db-table th { position: sticky; top: 0; background: #000; color: var(--primary); padding: 10px; border-bottom: 2px solid var(--primary); text-transform: uppercase; text-align: left; }
        .db-table td { padding: 8px 10px; border-bottom: 1px solid #333; color: #ccc; vertical-align: middle; }
        .db-table tr:hover { background: #222; }
        .btn-db-action { border: none; padding: 0 12px; height: 32px; border-radius: 6px; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 12px; cursor: pointer; text-transform: uppercase; display: inline-flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-db-load { background: rgba(0, 255, 136, 0.1); border: 1px solid var(--win-green); color: var(--win-green); }
        .btn-db-del { background: rgba(255, 62, 62, 0.1); border: 1px solid var(--danger-red); color: var(--danger-red); min-width: 32px; padding: 0; }
        .btn-csv { background: #10b981; color: #fff; border: none; padding: 12px; width: 100%; border-radius: 6px; margin-top: 15px; font-weight: bold; cursor: pointer; text-transform: uppercase; }

        .preview-textarea { width: 100%; height: 300px; background: #000; color: var(--primary); border: 1px solid #333; border-radius: 8px; padding: 15px; font-family: 'Courier New', monospace; font-size: 11px; resize: none; margin-bottom: 15px; }
        .btn-action-copy { background: var(--primary); color: #000; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 14px; }

        /* SCANNING */
        #scanOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 20000; justify-content: center; align-items: center; backdrop-filter: blur(10px); }
        .scan-content { text-align: center; width: 300px; font-family: 'Courier New', monospace; }
        .scan-icon { font-size: 50px; color: var(--primary); margin-bottom: 20px; }
        .scan-text { color: #fff; font-size: 18px; font-weight: bold; margin-bottom: 10px; letter-spacing: 2px; }
        .scan-detail { color: var(--primary); font-size: 12px; margin-top: 5px; opacity: 0.8; }
        .scan-bar-container { width: 100%; height: 4px; background: #333; border-radius: 2px; overflow: hidden; position: relative; }
        .scan-bar { width: 0%; height: 100%; background: var(--primary); box-shadow: 0 0 10px var(--primary); transition: width 0.1s linear; }

        @media (max-width: 1100px) { .session-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 700px) { .container{padding:15px;} .session-grid { grid-template-columns: 1fr; } .time-inputs{ grid-template-columns: 1fr; } .date-range-wrapper{flex-wrap: wrap; justify-content: center;} .header-area h2 { font-size: 32px; } }

        body.clean-mode { background: #f4f6f8 !important; color: #222 !important; cursor: default; }
        body.clean-mode .container { background: #ffffff; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border: 1px solid #d1d5db; border-top: 5px solid #333; }
        body.clean-mode .header-area h2 { color: #111 !important; text-shadow: none !important; }
        body.clean-mode #displayDate { color: #555; }
        body.clean-mode .controls, body.clean-mode .time-settings { background: #f3f4f6; border: 1px solid #e5e7eb; box-shadow: none; color: #000; }
        body.clean-mode .time-settings summary { color: #333; }
        body.clean-mode .time-group label { color: #555; }
        body.clean-mode .time-group input { background: #fff; color: #000; border: 1px solid #ccc; }
        body.clean-mode #lockBtn, body.clean-mode #startDateInput, body.clean-mode #genBtn, body.clean-mode #dbBtn { opacity: 0.3; pointer-events: none; filter: grayscale(100%); }
        body.clean-mode .day-label { color: #000; border-left-color: #000; text-shadow: none; }
        body.clean-mode .minimize-day-btn { background: #ccc; color: #000; border-color: #999; }
        body.clean-mode .date-badge { background: #e0e0e0; color: #333; border: 1px solid #ccc; }
        body.clean-mode .session-box { background: #fff; border: 2px solid #e5e7eb; box-shadow: none; }
        body.clean-mode .session-title { color: #000; border-bottom: 2px solid #000; }
        body.clean-mode .session-time { color: #666; font-weight: bold; }
        body.clean-mode .action-btn { background: #eee; color: #000; border-color: #ccc; }
        body.clean-mode .provider-label { color: #666; background: #eee; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        body.clean-mode .game-card { background: #f9fafb; border: 1px solid #d1d5db; color: #111; }
        body.clean-mode .game-card .game-name { color: #000; font-size: 13px; }
        body.clean-mode .game-card:hover { background: #fff; border-color: #000; box-shadow: none; }
        body.clean-mode .depo-container { background: #fffbe6; border: 1px solid #ffe58f; color: #000; }
        body.clean-mode .depo-header { color: #d46b08; border-bottom: 1px solid #ffe58f; }
        body.clean-mode .depo-info { color: #222; font-family: monospace; font-size: 12px; font-weight: bold; }
        body.clean-mode .badge { background: #eee !important; color: #000 !important; border: 1px solid #ccc; }
        body.clean-mode #designerBtn { background: #000; color: #fff; border-color: #000; }
        body.clean-mode .preview-textarea { background: #fff; color: #000; border-color: #ccc; }
        body.clean-mode .db-table th { background: #eee; color: #000; border-bottom: 2px solid #ccc; }
        body.clean-mode .db-table td { color: #000; border-bottom: 1px solid #ccc; }
    </style>
</head>
<body>

<div id="scanOverlay">
    <div class="scan-content">
        <div class="scan-icon"><i class="fas fa-microchip fa-spin"></i></div>
        <div class="scan-text" id="scanText">INITIALIZING SYSTEM...</div>
        <div class="scan-bar-container"><div class="scan-bar" id="scanBar"></div></div>
        <div class="scan-detail" id="scanDetail">Connect to server...</div>
    </div>
</div>

<div class="toast-container"><div id="customToast" class="toast"><i class="fas fa-check-circle"></i> <span id="toastMsg">ACTION SUCCESSFUL</span></div></div>
<div id="hover-tooltip"><img id="tooltip-img" src="" alt=""></div>

<div id="gameModal" class="modal" onclick="document.getElementById('gameModal').style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <button class="close-modal" onclick="document.getElementById('gameModal').style.display='none'">X</button>
        <img id="modalImg" src="" alt="">
        <h3 id="modalName" style="color:var(--primary); margin:0;"></h3>
    </div>
</div>

<div id="dbModal" class="modal" onclick="document.getElementById('dbModal').style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()" style="width: 800px; max-width: 95%;">
        <button class="close-modal" onclick="document.getElementById('dbModal').style.display='none'"><i class="fas fa-times"></i></button>
        <div class="modal-title"><i class="fas fa-database"></i> RIWAYAT SEED (CART)</div>
        <div class="db-controls">
            <input type="text" id="dbSearch" class="db-search" placeholder="Cari Web / Tanggal..." onkeyup="renderDatabase()">
            <select id="dbFilter" class="db-search" onchange="renderDatabase()">
                <option value="">SEMUA WEB</option>
                <option value="CAPTAIN77">CAPTAIN77</option>
                <option value="PLAY77">PLAY77</option>
                <option value="JAGUAR77">JAGUAR77</option>
                <option value="FUN77">FUN77</option>
                <option value="INDOPEDIA77">INDOPEDIA77</option>
                <option value="INDOFUN17">INDOFUN17</option>
                <option value="HOLYPLAY17">HOLYPLAY17</option>
                <option value="MUSTANG77">MUSTANG77</option>
            </select>
        </div>
        <div class="db-table-container"><table class="db-table" id="dbTableBody"></table></div>
        <button class="btn-csv" onclick="exportDatabaseToCSV()"><i class="fas fa-file-csv"></i> DOWNLOAD CSV</button>
    </div>
</div>

<div id="resultModal" class="modal" onclick="document.getElementById('resultModal').style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <button class="close-modal" onclick="document.getElementById('resultModal').style.display='none'"><i class="fas fa-times"></i></button>
        <div class="modal-title"><i class="fas fa-clipboard-list"></i> PREVIEW JADWAL</div>
        <div id="modalDateRange" class="preview-date">BERLAKU: -</div>
        <textarea id="resultText" class="preview-textarea" readonly></textarea>
        <button class="btn-action-copy" onclick="finalCopy()"><i class="fas fa-copy"></i> SALIN SEMUA TEKS</button>
    </div>
</div>

<div class="container">
    <div class="header-area">
        <h2>PLATFORM SCHEDULER V24 LITE</h2>
        <div class="date-range-wrapper">
            <div class="date-input-group">
                <label>DARI TANGGAL</label>
                <input type="date" id="startDateInput" onchange="updateEndDate(); liveUpdateView()">
            </div>
            <div class="arrow-separator">‚û°</div>
            <div class="date-input-group">
                <label>SAMPAI TANGGAL</label>
                <input type="text" id="endDateDisplay" readonly placeholder="Otomatis...">
            </div>
        </div>
        <div id="displayDate">READY TO SYNC</div>
    </div>
    
    <details class="time-settings" id="timeSettings">
        <summary><i class="fas fa-clock"></i> PENGATURAN JAM & POLA</summary>
        <div class="time-inputs">
            <div class="time-group"><label>MIDNIGHT</label><input type="text" id="timeMidnight" value="00:00 - 06:00 WIB" onchange="updateUrlState()"></div>
            <div class="time-group"><label>SIANG</label><input type="text" id="timeSiang" value="06:00 - 15:00 WIB" onchange="updateUrlState()"></div>
            <div class="time-group"><label>SORE</label><input type="text" id="timeSore" value="15:00 - 19:00 WIB" onchange="updateUrlState()"></div>
            <div class="time-group"><label>MALAM</label><input type="text" id="timeMalam" value="19:00 - 00:00 WIB" onchange="updateUrlState()"></div>
            <div class="time-group"><label style="color:var(--primary)">JUMLAH POLA</label><input type="number" id="patternCount" value="6" min="3" max="10" onchange="updateUrlState()"></div>
        </div>
    </details>

    <div class="controls">
        <select id="profileSelect" onchange="changeProfileHandler()">
            <option value="CAPTAIN77">CAPTAIN77</option>
            <option value="PLAY77">PLAY77</option>
            <option value="JAGUAR77">JAGUAR77</option>
            <option value="FUN77">FUN77</option>
            <option value="INDOPEDIA77">INDOPEDIA77</option>
            <option value="INDOFUN17">INDOFUN17</option>
            <option value="HOLYPLAY17">HOLYPLAY17</option>
            <option value="MUSTANG77">MUSTANG77</option>
        </select>
        <button id="lockBtn" onclick="toggleLock()"><i class="fas fa-unlock"></i></button>
        <button id="genBtn" onclick="initiateSync()">SYNC DATA</button>
        <button id="dbBtn" onclick="openDatabaseModal()"><i class="fas fa-database"></i> DB</button>
        <button id="shareBtn" onclick="copyShareLink()"><i class="fas fa-link"></i> LINK</button>
        <button id="designerBtn" onclick="toggleDesignerMode()"><i class="fas fa-eye"></i> MODE DESIGNER</button>
    </div>

    <div id="capture-area"><div id="hasil"></div></div>
</div>

<script>
let currentSeed = Date.now(); 
function mulberry32(a) { return function() { var t = a += 0x6D2B79F5; t = Math.imul(t ^ (t >>> 15), t | 1); t ^= t + Math.imul(t ^ (t >>> 7), t | 61); return ((t ^ (t >>> 14)) >>> 0) / 4294967296; } }
function seedRandom(seed) { return mulberry32(seed); }
let myRandom = Math.random; 
function shuffleArray(array) { let currentIndex = array.length, randomIndex; while (currentIndex != 0) { randomIndex = Math.floor(myRandom() * currentIndex); currentIndex--; [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]]; } return array; }

const PROFILE_CONFIG = {
    "CAPTAIN77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=0&single=true&output=csv",
    "JAGUAR77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=1165225864&single=true&output=csv",
    "INDOPEDIA77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=288756155&single=true&output=csv",
    "FUN77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=288756155&single=true&output=csv",
    "PLAY77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=410917478&single=true&output=csv",
    "MUSTANG77": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=1769820056&single=true&output=csv",
    "HOLYPLAY17": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=265631998&single=true&output=csv",
    "INDOFUN17": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYLkswRdyQIUIBvcS1-_D6AUqrvqVo9u13KJbMT7aNJXnG8v6wfNMYmivF96G2eHwiSm6I-K64-1qY/pub?gid=2086618792&single=true&output=csv"
};

const THEMES = {
    "CAPTAIN77": { primary: "#00f2ff" }, "PLAY77": { primary: "#3b82f6" }, "JAGUAR77": { primary: "#FFD700" },
    "FUN77": { primary: "#ff3e3e" }, "INDOPEDIA77": { primary: "#4ade80" }, "INDOFUN17": { primary: "#ff0055" },
    "HOLYPLAY17": { primary: "#d8b4fe" }, "MUSTANG77": { primary: "#00ff88" }
};

// --- REFACTORED GAME DISTRIBUTION CONFIG ---
const GAME_DISTRIBUTION = {
    "CAPTAIN77": { "MIDNIGHT":{pp:3,pg:2}, "SIANG":{pp:2,pg:2}, "SORE":{pp:2,pg:0}, "MALAM":[{pp:1,pg:0},{pp:0,pg:1}] },
    "JAGUAR77": { "MIDNIGHT":{pp:3,pg:2}, "SIANG":{pp:2,pg:2}, "SORE":[{pp:2,pg:0},{pp:1,pg:1}], "MALAM":[{pp:1,pg:0},{pp:0,pg:1}] },
    "FUN77": { "MIDNIGHT":{pp:3,pg:2}, "SIANG":{pp:2,pg:2}, "SORE":[{pp:2,pg:0},{pp:1,pg:1}], "MALAM":{pp:1,pg:1} },
    "MUSTANG77": { "MIDNIGHT":{pp:2,pg:2}, "SIANG":{pp:2,pg:2}, "SORE":{pp:1,pg:0}, "MALAM":{pp:0,pg:1} },
    "INDOPEDIA77": { "MIDNIGHT":{pp:2,pg:2}, "SIANG":{pp:3,pg:3}, "SORE":[{pp:1,pg:0},{pp:2,pg:0}], "MALAM":[{pp:1,pg:0},{pp:0,pg:1}] },
    "HOLYPLAY17": { "MIDNIGHT":{pp:2,pg:2}, "SIANG":{pp:2,pg:2}, "SORE":{pp:2,pg:0}, "MALAM":{pp:0,pg:2} },
    "INDOFUN17": { "MIDNIGHT":{pp:2,pg:2}, "SIANG":{pp:2,pg:2}, "SORE":{pp:2,pg:0}, "MALAM":{pp:0,pg:1} },
    "PLAY77": { "MIDNIGHT":[{pp:2,pg:0},{pp:1,pg:0}], "SIANG":{pp:2,pg:2}, "SORE":[{pp:1,pg:0},{pp:2,pg:0},{pp:1,pg:1}], "MALAM":{pp:0,pg:1} }
};

let poolPragmatic = { gold:[], silver:[], bronze:[], guide:[] };
let poolPGSoft = { gold:[], silver:[], bronze:[], guide:[] };
let gameImageMap = {};
let depositSettings = { "MIDNIGHT":[], "SIANG":[], "SORE":[], "MALAM":[] };
let globalMemory = [];
let uniqueCodePool = [];

function changeTheme() {
    const selected = document.getElementById("profileSelect").value;
    const theme = THEMES[selected] || THEMES["CAPTAIN77"];
    document.documentElement.style.setProperty('--primary', theme.primary);
}

function checkUrlParams() {
    const urlParams = new URLSearchParams(window.location.search);
    const seed = urlParams.get('seed');
    const profile = urlParams.get('profile');
    const dateParam = urlParams.get('date');
    if(urlParams.get('tM')) document.getElementById('timeMidnight').value = decodeURIComponent(urlParams.get('tM'));
    if(urlParams.get('tS')) document.getElementById('timeSiang').value = decodeURIComponent(urlParams.get('tS'));
    if(urlParams.get('tSo')) document.getElementById('timeSore').value = decodeURIComponent(urlParams.get('tSo'));
    if(urlParams.get('tMa')) document.getElementById('timeMalam').value = decodeURIComponent(urlParams.get('tMa'));
    if(urlParams.get('pC')) document.getElementById('patternCount').value = urlParams.get('pC');

    if (seed && profile) {
        currentSeed = parseInt(seed); 
        myRandom = seedRandom(currentSeed); 
        document.getElementById("profileSelect").value = profile;
        if(dateParam) {
            document.getElementById("startDateInput").value = dateParam;
            updateEndDate(); 
        }
        changeProfileHandler(); 
        fetchDatabase();
    } else {
        currentSeed = Date.now();
        myRandom = Math.random;
        document.getElementById("startDateInput").valueAsDate = new Date();
        updateEndDate(); 
        loadTimeSettings(); 
        updateUrlState(); 
    }
}

async function fetchDatabase() {
    const selected = document.getElementById("profileSelect").value;
    const btn = document.getElementById("genBtn");
    btn.disabled = true; btn.innerText = "LOADING...";
    try {
        const response = await fetch(PROFILE_CONFIG[selected]);
        const data = await response.text();
        const lines = data.split(/\r?\n/).filter(l => l.trim() !== "");
        poolPragmatic = { gold:[], silver:[], bronze:[], guide:[] }; poolPGSoft = { gold:[], silver:[], bronze:[], guide:[] };
        gameImageMap = {}; depositSettings = { "MIDNIGHT":[], "SIANG":[], "SORE":[], "MALAM":[] };
        
        lines.slice(1).forEach(line => {
            let cols = line.replace(/"/g, '').split(',').map(c => c.trim());
            if (cols.length >= 3) {
                const prov = cols[0]; const tier = cols[1].toUpperCase(); const name = cols[2]; 
                let meta = cols[3] || ""; let extra = cols[4] || ""; 
                if (!meta.includes('|') && extra !== "") meta = meta + "|" + extra;
                meta = meta.replace(/\*\*/g, '');
                
                if (prov === "SETTING" && tier.startsWith("DEPO_")) {
                    const sess = tier.replace("DEPO_", "");
                    if (depositSettings[sess]) depositSettings[sess].push({ range: name, info: meta });
                } else if (name) {
                    if (meta && !meta.includes('|')) gameImageMap[name] = meta; 
                    const t = cols[1].toLowerCase();
                    if (prov === "Pragmatic") { if(t==='guide') poolPragmatic.guide.push(name); else if(poolPragmatic[t]) poolPragmatic[t].push(name); }
                    else if (prov === "PGSoft") { if(t==='guide') poolPGSoft.guide.push(name); else if(poolPGSoft[t]) poolPGSoft[t].push(name); }
                }
            }
        });
        myRandom = seedRandom(currentSeed); generateJadwal();
        btn.disabled = false; btn.innerText = "SYNC DATA";
        if(isLocked) btn.disabled = true;
    } catch (e) { alert("Gagal mengambil data! Cek koneksi."); btn.disabled = false; btn.innerText = "RETRY"; }
}

function getUniqueCode() {
    if (uniqueCodePool.length === 0) { uniqueCodePool = [1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000]; shuffleArray(uniqueCodePool); }
    return uniqueCodePool.pop();
}

// --- UNIFIED STRATEGY LOGIC ---
function getStrategy(prov) {
    let list = (prov === 'Pragmatic') ? poolPragmatic.guide : poolPGSoft.guide;
    if (!list || list.length === 0) return { html: "<div>Pola Kurang</div>", text: "" };

    let targetLines = parseInt(document.getElementById('patternCount').value) || 6; 
    let headerText = "BET NOMINAL BEBAS";
    let headerHtml = `<div style="color: #fff; font-size: 10px; margin-bottom: 3px; font-weight: bold; letter-spacing:1px; text-transform:uppercase;">${headerText}</div>`;
    
    let dcText = ""; let badgeHtml = "";
    if (prov === 'Pragmatic') {
        const state = myRandom() > 0.5 ? "ON" : "OFF"; dcText = `FITUR GANDA ${state}`;
        badgeHtml = `<span class="badge" style="background:var(--primary); color:#000; margin-bottom:5px; display:inline-block;">${dcText}</span>`;
    }

    let selected = [];
    let buySpinList = list.filter(i => i.toUpperCase().includes("BUY") || i.toUpperCase().includes("BELI"));
    let normalList = list.filter(i => !i.toUpperCase().includes("BUY") && !i.toUpperCase().includes("BELI"));
    if (normalList.length === 0) normalList = [...list];

    // Determine target for normal steps
    let normalTarget = (prov === 'Pragmatic') ? targetLines - 1 : targetLines;
    if (normalTarget < 1) normalTarget = 1;

    let shuffledNormal = [...normalList]; shuffleArray(shuffledNormal);
    let usedTypes = [];
    const getType = (str) => {
        let clean = str.toUpperCase();
        if (clean.includes("MANUAL")) return "MANUAL";
        if (clean.includes("AUTO")) return "AUTO"; 
        if (clean.includes("TURBO")) return "TURBO";
        return clean.replace(/[0-9X\.\-]/g, '').trim(); 
    };

    // 1. Fill Normal Steps (Unique Types)
    for (let i = 0; i < shuffledNormal.length; i++) {
        if (selected.length >= normalTarget) break;
        let item = shuffledNormal[i];
        let type = getType(item);
        if (!usedTypes.includes(type)) { selected.push(item); usedTypes.push(type); }
    }
    // Fallback Normal
    while (selected.length < normalTarget) {
        let randomItem = normalList[Math.floor(myRandom() * normalList.length)];
        if (selected.length > 0 && selected[selected.length-1] === randomItem && normalList.length > 1) continue;
        selected.push(randomItem);
    }

    // 2. Add Buy Spin (Pragmatic only)
    if (prov === 'Pragmatic') {
        let buySpinItem = buySpinList.length > 0 ? buySpinList[Math.floor(myRandom() * buySpinList.length)] : "POLA KHUSUS: BUY SPIN";
        selected.push(buySpinItem);
    }

    let stepsHtml = selected.map(s => `<div class="step-row"><span>${s}</span></div>`).join('');
    let stepsText = selected.map(s => `> ${s}`).join('\n');
    const footerMsg = "NAIKAN BET SECARA BERTAHAP & ULANGI POLA";
    let footerHtml = `<div class="step-row" style="margin-top:5px; border-top:1px dashed #444; padding-top:5px;"><span style="color:var(--warn-yellow); font-weight:800; font-size:9px;">${footerMsg}</span></div>`;
    
    let fullText = `${headerText}\n${dcText ? dcText + '\n' : ''}${stepsText}\n\n${footerMsg}`;
    return { html: `<div class="guide-container">${headerHtml}${badgeHtml}${stepsHtml}${footerHtml}</div>`, text: fullText };
}

function getDeposit(sess) {
    let tail = getUniqueCode();
    let data = depositSettings[sess];
    const currentProfile = document.getElementById("profileSelect").value;
    if (currentProfile === "FUN77" && data && data.length > 0) data = [data[0]]; 
    if (!data || data.length === 0) return { html: "", text: "", code: tail };
    
    let html = `<div class="depo-container"><div class="depo-header">KODE JITU EKOR: ${tail}</div>`;
    let text = "";
    const processValue = (rawStr) => {
        if (!rawStr) return 0;
        let num = parseInt(rawStr.toString().replace(/\D/g, '')) || 0;
        return (Math.floor(num / 1000) * 1000) + tail;
    };
    data.forEach((item, i) => {
        let parts = item.range.split('-');
        let meta = item.info.split('|');
        let bonus = meta[0] || "UNK"; let rate = meta[1] || "90%";
        let minVal = processValue(parts[0]);
        let maxVal = parts.length === 2 ? processValue(parts[1]) : 0;
        let nominal = parts.length === 2 ? `DEPO Rp ${minVal.toLocaleString()} - Rp ${maxVal.toLocaleString()}` : `SPECIAL DEPO Rp ${minVal.toLocaleString()}`;
        html += `<div class="depo-item"><span class="depo-info">${i+1}. ${nominal}</span><div class="depo-meta"><span class="tag-bonus">BONUS ${bonus}</span><span class="tag-rate">RATE ${rate}</span></div></div>`;
        text += `${i+1}. ${nominal} (Bonus ${bonus} | Rate ${rate})\n`;
    });
    html += `</div>`;
    return { html, text, code: tail };
}

function getGameTheme(gameName) {
    if (!gameName) return "";
    let n = gameName.toLowerCase();
    if(n.includes("olympus")) return "olympus"; if(n.includes("starlight")) return "starlight";
    if(n.includes("bonanza")) return "bonanza"; if(n.includes("mahjong")) return "mahjong";
    if(n.includes("neko")) return "neko"; if(n.includes("aztec")) return "aztec";
    if(n.includes("thor")) return "thor"; if(n.includes("wild bandito")) return "bandito";
    if(n.includes("sugar")) return "sugar"; if(n.includes("gatot")) return "gatot";
    if(n.includes("princess")) return "princess"; 
    return n.split(" ")[0];
}

function pickGame(prov, tier, blacklist, daily, previousThemes, currentThemes, yesterdayThemes) {
    let list = (prov === 'Pragmatic') ? poolPragmatic[tier] : poolPGSoft[tier];
    if (!list || list.length === 0) return { name: "DATA KOSONG", html: "", theme: "" };
    
    let available = list.filter(g => {
        let theme = getGameTheme(g);
        if(blacklist.includes(g) || daily.includes(g)) return false;
        if(currentThemes.includes(theme)) return false;
        if(previousThemes.includes(theme)) return false;
        if(yesterdayThemes && yesterdayThemes.includes(theme)) return false;
        return true;
    });
    if (available.length === 0) available = list.filter(g => !blacklist.includes(g) && !daily.includes(g));
    if (available.length === 0) available = list; 

    const chosen = available[Math.floor(myRandom() * available.length)];
    return { 
        name: chosen, theme: getGameTheme(chosen),
        html: `<div class="game-card" onclick="showImg('${chosen}')"><span class="game-name">${chosen}</span><span class="badge" style="background:${tier==='gold'?'#ffd700':tier==='silver'?'#c0c0c0':'#cd7f32'};color:#000">${tier}</span></div>` 
    };
}

function showImg(name) {
    document.getElementById('modalName').innerText = name;
    document.getElementById('modalImg').src = gameImageMap[name] || 'https://via.placeholder.com/400x250?text=NO+IMAGE';
    document.getElementById('gameModal').style.display = 'flex';
}

function resolveGameCounts(profile, sessionName) {
    const config = GAME_DISTRIBUTION[profile] || GAME_DISTRIBUTION["CAPTAIN77"];
    const sessionConfig = config[sessionName];
    if (Array.isArray(sessionConfig)) return sessionConfig[Math.floor(myRandom() * sessionConfig.length)];
    return sessionConfig;
}

function generateJadwal() {
    const profile = document.getElementById("profileSelect").value;
    const dateInputStr = document.getElementById('startDateInput').value;
    let startDate = dateInputStr ? new Date(dateInputStr) : new Date();
    let endDate = new Date(startDate); endDate.setDate(startDate.getDate() + 6);
    document.getElementById('displayDate').innerText = `PERIODE: ${startDate.toLocaleDateString('id-ID')} - ${endDate.toLocaleDateString('id-ID')}`.toUpperCase();
    
    const times = {
        "MIDNIGHT": document.getElementById('timeMidnight').value, "SIANG": document.getElementById('timeSiang').value,
        "SORE": document.getElementById('timeSore').value, "MALAM": document.getElementById('timeMalam').value
    };
    const days = ["SENIN","SELASA","RABU","KAMIS","JUMAT","SABTU","MINGGU"];
    uniqueCodePool = []; globalMemory = [];
    let html = ""; let yesterday = [];
    let historyPerSession = { "MIDNIGHT": [], "SIANG": [], "SORE": [], "MALAM": [] };

    days.forEach((day, dayIndex) => {
        let currentDate = new Date(startDate); currentDate.setDate(startDate.getDate() + dayIndex);
        let dateBadge = currentDate.toLocaleDateString('id-ID', {day: '2-digit', month: '2-digit', year: '2-digit'});
        let todayGames = []; let dayData = { day: day, date: dateBadge, sessions: [] };
        let previousSessionThemes = []; let todaySessionThemes = { "MIDNIGHT": [], "SIANG": [], "SORE": [], "MALAM": [] };

        const draw = (p, t, currentThemes, sessKey) => { 
            let res = pickGame(p, t, yesterday, todayGames, previousSessionThemes, currentThemes, historyPerSession[sessKey]); 
            if (res.name !== "DATA KOSONG") todayGames.push(res.name); 
            return res; 
        }

        const buildSession = (label, sessKey, sessIndex) => {
            const timeStr = times[sessKey];
            const counts = resolveGameCounts(profile, sessKey);
            let sessionHtml = ""; let rawTxt = ""; let currentSessionThemes = [];

            if (counts.pp > 0) {
                let ppContent = ""; let ppText = "";
                for(let i=0; i<counts.pp; i++) {
                    let tier = (sessKey === "SORE") ? 'gold' : (i===0 ? 'gold' : (i===1 ? 'silver' : 'bronze'));
                    let g = draw('Pragmatic', tier, currentSessionThemes, sessKey);
                    currentSessionThemes.push(g.theme); todaySessionThemes[sessKey].push(g.theme);
                    ppContent += g.html; ppText += `${g.name}\n`;
                }
                let stP = getStrategy('Pragmatic');
                sessionHtml += `<div class="provider-label">PRAGMATIC PLAY</div>${ppContent}${stP.html}`;
                rawTxt += `--- PRAGMATIC PLAY ---\n${ppText}\nPOLA PRAGMATIC:\n${stP.text}\n\n`;
            }
            if (counts.pg > 0) {
                let pgContent = ""; let pgText = "";
                for(let i=0; i<counts.pg; i++) {
                    let tier = (sessKey === "SORE") ? 'gold' : (i===0 ? 'gold' : 'silver');
                    let g = draw('PGSoft', tier, currentSessionThemes, sessKey);
                    currentSessionThemes.push(g.theme); todaySessionThemes[sessKey].push(g.theme);
                    pgContent += g.html; pgText += `${g.name}\n`;
                }
                let stPg = getStrategy('PGSoft');
                sessionHtml += `<div class="provider-label">PG SOFT</div>${pgContent}${stPg.html}`;
                rawTxt += `--- PG SOFT ---\n${pgText}\nPOLA PG SOFT:\n${stPg.text}`;
            }
            
            previousSessionThemes = [...currentSessionThemes];
            let depo = getDeposit(sessKey);
            dayData.sessions.push({ title: label, time: timeStr, games: rawTxt.trim(), depo: depo });
            return `<div class="session-box"><div class="session-header"><div class="session-title">${label}</div><span class="session-time">${timeStr}</span><div class="action-container"><button class="action-btn minimize-btn" onclick="toggleSession(this)"><i class="fas fa-window-minimize"></i></button><button class="action-btn copy-btn" onclick="copySession(${dayIndex}, ${sessIndex})"><i class="fas fa-copy"></i></button></div></div><div class="session-content">${sessionHtml}${depo.html}</div></div>`;
        };
        html += `<div class="day-row"><div class="day-header"><span class="day-label">${day} <span class="date-badge">${dateBadge}</span></span><button class="minimize-day-btn" onclick="toggleDay(this)"><i class="fas fa-window-minimize"></i></button></div><div class="session-grid">`;
        html += buildSession("üåë MIDNIGHT", "MIDNIGHT", 0); html += buildSession("‚òÄÔ∏è SIANG", "SIANG", 1);
        html += buildSession("üåá SORE", "SORE", 2); html += buildSession("üåô MALAM", "MALAM", 3);
        html += `</div></div>`;
        globalMemory.push(dayData); yesterday = [...todayGames]; historyPerSession = todaySessionThemes;
    });
    document.getElementById("hasil").innerHTML = html;
}

function toggleSession(btn) { const box = btn.closest('.session-box'); box.classList.toggle('collapsed'); }
function toggleDay(btn) { const row = btn.closest('.day-row'); row.classList.toggle('collapsed'); }
function saveTimeSettings() { localStorage.setItem('schedulerTimeSettings', JSON.stringify({ midnight: document.getElementById('timeMidnight').value, siang: document.getElementById('timeSiang').value, sore: document.getElementById('timeSore').value, malam: document.getElementById('timeMalam').value })); liveUpdateView(); }
function loadTimeSettings() { const saved = localStorage.getItem('schedulerTimeSettings'); if (saved) { const s = JSON.parse(saved); if(s.midnight) document.getElementById('timeMidnight').value = s.midnight; if(s.siang) document.getElementById('timeSiang').value = s.siang; if(s.sore) document.getElementById('timeSore').value = s.sore; if(s.malam) document.getElementById('timeMalam').value = s.malam; } }
function openResultModal(text) { const m = document.getElementById("resultModal"); document.getElementById("resultText").value = text; document.getElementById("modalDateRange").innerText = "BERLAKU: " + document.getElementById("displayDate").innerText.replace("PERIODE: ", ""); m.style.display = 'flex'; }
function finalCopy() { document.getElementById("resultText").select(); document.execCommand('copy'); showToast("TEKS BERHASIL DISALIN!"); }
function copySession(d, s) { const data = globalMemory[d].sessions[s]; openResultModal(`=================================\nHARI: ${globalMemory[d].day}, ${globalMemory[d].date}\nSESI: ${data.title} (${data.time})\n=================================\n\n${data.games}\n\n---------------------------------\nKODE EKOR: ${data.depo.code}\n---------------------------------\nLIST DEPOSIT:\n${data.depo.text}`); }
function toggleLock() { isLocked = !isLocked; const b = document.getElementById("lockBtn"); b.classList.toggle("locked"); b.innerHTML = isLocked ? '<i class="fas fa-lock"></i>' : '<i class="fas fa-unlock"></i>'; document.getElementById("genBtn").disabled = isLocked; document.getElementById("startDateInput").disabled = isLocked; }
function toggleDesignerMode() { document.body.classList.toggle("clean-mode"); document.body.classList.contains("clean-mode") ? (showToast("DESIGNER MODE"), document.addEventListener('mousemove', handleTooltip)) : (showToast("DARK MODE"), document.removeEventListener('mousemove', handleTooltip), document.getElementById('hover-tooltip').style.display = 'none'); }
function handleTooltip(e) { if (!document.body.classList.contains('clean-mode')) return; const t = e.target.closest('.game-card'); const tip = document.getElementById('hover-tooltip'); if (t && gameImageMap[t.querySelector('.game-name').innerText]) { tip.firstElementChild.src = gameImageMap[t.querySelector('.game-name').innerText]; tip.style.display = 'block'; tip.style.top = (e.clientY+15)+'px'; tip.style.left = (e.clientX+15)+'px'; } else tip.style.display = 'none'; }
function showToast(msg) { const t = document.getElementById("customToast"); document.getElementById("toastMsg").innerText = msg; t.classList.add("show"); setTimeout(() => t.classList.remove("show"), 3000); }
function copyShareLink() { updateUrlState(); navigator.clipboard.writeText(window.location.href).then(() => showToast("LINK TERSALIN!")); }
// DB Functions (Simplified)
function openDatabaseModal() { renderDatabase(); document.getElementById('dbModal').style.display = 'flex'; }
function renderDatabase() { let db = JSON.parse(localStorage.getItem('schedulerDB')||"[]"), h = `<thead><tr><th>WEB</th><th>TANGGAL</th><th>WAKTU</th><th>AKSI</th></tr></thead><tbody>`, s = document.getElementById('dbSearch').value.toLowerCase(), f = document.getElementById('dbFilter').value; const res = db.filter(i => (i.profile.toLowerCase().includes(s)||i.dateStart.toLowerCase().includes(s)) && (f===""||i.profile===f)); if(res.length===0) h+=`<tr><td colspan="4" style="text-align:center;">KOSONG</td></tr>`; else res.forEach(i => h+=`<tr><td>${i.profile}</td><td>${i.dateStart}</td><td>${i.timestamp}</td><td><div class="db-action-group"><button class="btn-db-action btn-db-load" onclick="loadFromDatabase(${i.seed},'${i.profile}','${i.dateStart}')">LOAD</button><button class="btn-db-action btn-db-del" onclick="deleteFromDatabase(${i.id})">X</button></div></td></tr>`); h+=`</tbody>`; document.getElementById('dbTableBody').innerHTML = h; }
window.onload = function() { checkUrlParams(); };
</script>
</body>
</html>
